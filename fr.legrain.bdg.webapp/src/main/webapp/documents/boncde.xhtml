<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pe="http://primefaces.org/ui/extensions"
    	xmlns:o="http://omnifaces.org/ui"
	xmlns:p="http://primefaces.org/ui">
	
	<o:importConstants type="fr.legrain.bdg.webapp.app.LgrTab" />

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="variableEcran" value="Boncde" />
		</f:metadata>
	</ui:define>
	
	<!-- <f:validateBean disabled="true"> -->
			<div class="dashboard-title" style="background: #f0f1f2; margin-bottom: 15px;">
						<h:panelGroup id="idPanelGroupInfosTiersEnteteBonCde" rendered="#{!bonCdeController.selectedDocumentDTO.BoncdeEstVide()}">
						<p:spacer width="30" height="5" />
						<p:outputLabel value="Code : " />
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.codeDocument}" style="font-weight: bold;"/>
						<p:spacer width="30" height="5" />
						<p:outputLabel value="Code tiers : " />
							<p:commandLink 	value="#{bonCdeController.selectedDocumentDTO.codeTiers}"
											style="font-weight: bold;" 
											action="#{bonCdeController.ouvertureTiersBean.detailTiers(bonCdeController.ouvertureTiersBean.recupCodetiers(bonCdeController.selectedDocumentDTO.codeTiers))}" update=":form:tabView"
											oncomplete="activeTabCenter('#{bonCdeController.ouvertureTiersBean.event.cssLgrTab}');">
							</p:commandLink>						
<!-- 						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.codeTiers}" style="font-weight: bold;"/> -->
						<p:spacer width="30" height="5" />
						<p:outputLabel value="Nom : " />
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.nomTiers} #{bonCdeController.selectedDocumentDTO.prenomTiers}" style="font-weight: bold;"/>
						<p:spacer width="30" height="5" />
						<p:outputLabel value="Raison sociale : " />
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.nomEntreprise}" style="font-weight: bold;"/>
						</h:panelGroup>
			</div>


	<p:menubar styleClass="menu-onglet" id="idMenuBoutonBoncde" widgetVar="wvMenuBoutonBoncde">

	<p:menuitem title="#{c_boncommande.titre_menu_aide}" styleClass="icon icon-aidecontextuelle" onstart="PF('wvAideMenuBc').show()" />
	<p:separator styleClass="separateur-menu-vertical"/>		
			
<!-- 			onsuccess="impressionDirect(PF('wvImpressionDirectBoncde'),'ddd')" -->
<!-- oncomplete="if(PF('wvImpressionDirectBoncde').checked) {window.open('#{request.contextPath}/output?__report=/reports/Fiche_boncde.rptdesign&amp;__format=pdf'}" -->
		<p:menuitem value="Enregistrer" styleClass="icon icon-save" process="@this idtiersBoncde idCodeBoncde"
			title="#{c_boncommande.titre_menu_enregistrer}"
			actionListener="#{bonCdeController.actEnregistrer}" 
			oncomplete="impressionDirect(PF('wvImpressionDirectBoncde'),'#{request.contextPath}/output?__report=/reports/documents/boncde/Fiche_boncde.rptdesign&amp;__format=pdf')"
			update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde),@widgetVar(#{bonCdeController.wvEcran})"
			disabled="#{bonCdeController.etatBouton('enregistrer') or bonCdeController.stepEnCours('idLignesBoncde')}" />
			
		<p:menuitem value="Insérer" styleClass="icon icon-insert"
			title="#{c_boncommande.titre_menu_inserer}"
			actionListener="#{bonCdeController.actInserer}" process="@this"
			oncomplete="if(PF('widgetVarLigneBoncde').getStepIndex()!=-1) {PF('widgetVarLigneBoncde').loadStep('idEnteteBoncde', false)}"
			update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,idPrecisionPrixBcde,:form:messages,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde),@widgetVar(#{bonCdeController.wvEcran})"
			disabled="#{bonCdeController.etatBouton('inserer') or bonCdeController.stepEnCours('idLignesBoncde')}" />
			
		<p:menuitem value="Modifier" styleClass="icon icon-update"
			title="#{c_boncommande.titre_menu_modifier}"
			actionListener="#{bonCdeController.actModifier}"
			process="@this"
			update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(#{bonCdeController.wvEcran}),@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"
			disabled="#{bonCdeController.etatBouton('modifier') }" >
			<p:confirm header="#{bonCdeController.titreModification}" message="#{bonCdeController.messageModification}" icon="ui-icon-alert" />
		</p:menuitem>
			
			
		<p:menuitem value="Annuler" styleClass="icon icon-cancel"
			title="#{c_boncommande.titre_menu_annuler}"
			actionListener="#{bonCdeController.actAnnuler}" process="@this"
			update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(#{bonCdeController.wvEcran}),@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"
			disabled="#{bonCdeController.etatBouton('annuler') }" >
		<p:confirm header="Confirmation" message="#{msg_diag.alert_annulation}"  icon="ui-icon-alert" />
		</p:menuitem>

		<p:menuitem value="Supprimer" styleClass="icon icon-delete menuitem-poubelle-droite"
			title="#{c_boncommande.titre_menu_supprimer}"
			actionListener="#{bonCdeController.actSupprimer}"
			process="@this"
			update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(wvDataTableListeBoncde),@widgetVar(wvMenuListeBoncde),@widgetVar(#{bonCdeController.wvEcran})"
			disabled="#{bonCdeController.etatBouton('supprimer') or bonCdeController.stepEnCours('idLignesBoncde')}" >
<!-- 			<p:confirm header="Confirmation" message="#{msg_diag.alert_suppresion}" icon="ui-icon-alert" /> -->
			<p:confirm header="Confirmation de la suppression" message="#{bonCdeController.messageSuppression}" icon="ui-icon-alert" />

		</p:menuitem>			
			
		<p:menuitem value="Fermer" styleClass="icon icon-close menuitem-fermer-droite"
			title="#{c_boncommande.titre_menu_fermer}"
			process="@this" 
			actionListener="#{bonCdeController.actFermer}"
			update=":form:messages,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"
			disabled="#{bonCdeController.etatBouton('fermer') }" 
			onstart="PF('widgetVarTabView').remove(PF('widgetVarTabView').getActiveIndex())">
			
			<p:confirm header="Confirmation" message="#{msg_diag.alert_fermeture_onglet}" icon="ui-icon-alert" disabled="#{!bonCdeController.modeEcran.dataSetEnModif()}"/>
		</p:menuitem>

		<p:menuitem title="Créer un évènement" styleClass="icon-agenda icon" 
			
			oncomplete="$('.classHiddenCommandForDialogAgendaReturnBCde').click()"
			process="@this" 
			update="@this" 
			disabled="#{bonCdeController.etatBouton('modifier')}"/>

		<p:separator styleClass="separateur-menu-vertical"/>

		<!-- JE TAFF ICI POUR LE CHOIX EDITION A L'IMPRESSION -->
	<p:submenu  icon="ui-icon-print"  class="ui-icon-print-option">
	<!-- NEW BUTTON COMME FACTURE AVEC EDITION DEFAUT 29/10/19 -->
	<p:menuitem title="#{c_boncommande.titre_menu_imprimer} pour le client" value="Imprimer pour le client" icon="fa fa-print"
				disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde')) }"
				actionListener="#{bonCdeController.imprimeEdition(null, 'CLIENT', 'true')}"
				update="idTableauComplementaireBoncde">
				<p:confirm header="Confirmation" disabled="#{bonCdeController.selectedDocumentDTO.estMisADisposition}" message="Etes-vous sur de vouloir mettre à disposition du client ce document ? " icon="ui-icon-alert" />
	</p:menuitem>
	<p:submenu label="Tous les modèles" disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde'))}">
		 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop">
		       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}" actionListener="#{bonCdeController.imprimeEdition(edition, 'CLIENT', 'true')}" 
		       update="idTableauComplementaireBoncde">
				<p:confirm header="Confirmation" disabled="#{bonCdeController.selectedDocumentDTO.estMisADisposition}" message="Etes-vous sur de vouloir mettre à disposition du client ce document ? " icon="ui-icon-alert" />
				</p:menuitem >
		   </c:forEach>
	</p:submenu>
			
<!-- 			<p:separator /> -->
<!-- 	<p:menuitem title="#{c_boncommande.titre_menu_imprimer} en Duplicata" value="Duplicata" icon="fa fa-print" -->
<!-- 		disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde')) or !bonCdeController.selectedDocumentDTO.estMisADisposition}" -->
<!-- 		actionListener="#{bonCdeController.imprimeEdition(null, 'DUPLICATA', 'false')}"> -->
<!-- 	</p:menuitem> -->
	
<!-- 	<p:submenu label="Tous les modèles" -->
<!-- 	 disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde')) or !bonCdeController.selectedDocumentDTO.estMisADisposition}"> -->
<!-- 		 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop"> -->
<!-- 		       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}" actionListener="#{bonCdeController.imprimeEdition(edition, 'DUPLICATA', 'false')}"> -->
<!-- 				</p:menuitem > -->
<!-- 		   </c:forEach> -->
<!-- 	</p:submenu> -->
			
			<p:separator />
	<p:menuitem  title="#{c_bonCde.titre_menu_imprimer} en brouillon" value="Brouillon" icon="fa fa-print"
				disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde')) or bonCdeController.selectedDocumentDTO.estMisADisposition }"
				actionListener="#{bonCdeController.imprimeEdition(null, 'BROUILLON', 'false')}">
	</p:menuitem >
	<p:submenu label="Tous les modèles" disabled="#{(bonCdeController.etatBouton('imprimer') or bonCdeController.stepEnCours('idLignesBoncde')) or bonCdeController.selectedDocumentDTO.estMisADisposition }">
			 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop">
			       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}" actionListener="#{bonCdeController.imprimeEdition(edition, 'BROUILLON', 'false')}">
					</p:menuitem >
			   </c:forEach>
	</p:submenu>
			 
	</p:submenu>
	<!-- FIN NEW BUTTONS -->
			
		<p:menuitem value="Imprimer étiquette code barre" styleClass="icon icon-barcode"
						onsuccess="window.open('#{request.contextPath}/articles/etiquette_cb.xhtml')"
						actionListener="#{bonCdeController.actImprimerEtiquetteCB}"/>	
							
		<p:submenu  icon="ui-icon-mail"  class="ui-icon-mail-option">
			
			<p:menuitem  title="Envoyer par email pour le client" value="Envoyer au client" icon="fa fa-paper-plane"
				disabled="#{bonCdeController.etatBouton('modifier')}"
				oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()"
				update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@form,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"
				actionListener="#{bonCdeController.envoiMailEdition(null, 'CLIENT', 'true')}">
				<p:confirm header="Confirmation" disabled="#{bonCdeController.selectedDocumentDTO.estMisADisposition}" message="Etes-vous sur de vouloir mettre à disposition du client ce document? " icon="ui-icon-alert" />
				</p:menuitem >
				<p:submenu label="Tous les modèles" disabled="#{bonCdeController.etatBouton('modifier')}">
					 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop">
					       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}"
					        actionListener="#{bonCdeController.envoiMailEdition(edition, 'CLIENT', 'true')}"
					         oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()">
					         <p:confirm header="Confirmation" disabled="#{bonCdeController.selectedDocumentDTO.estMisADisposition}" message="Etes-vous sur de vouloir mettre à disposition du client ce document ? " icon="ui-icon-alert" />
							</p:menuitem >
					   </c:forEach>
				</p:submenu>
				
<!-- 				<p:separator /> -->
				
<!-- 				<p:menuitem  title="Envoyer par email en duplicata" value="Duplicata" icon="fa fa-paper-plane" -->
<!-- 				disabled="#{bonCdeController.etatBouton('modifier') or !bonCdeController.selectedDocumentDTO.estMisADisposition}" -->
<!-- 				oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()" -->
<!-- 				update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@form,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)" -->
<!-- 				actionListener="#{bonCdeController.envoiMailEdition(null, 'DUPLICATA', 'false')}"> -->
<!-- 				</p:menuitem > -->
<!-- 				<p:submenu label="Tous les modèles" disabled="#{bonCdeController.etatBouton('modifier') or !bonCdeController.selectedDocumentDTO.estMisADisposition}"> -->
<!-- 					 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop"> -->
<!-- 					       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}" -->
<!-- 					        actionListener="#{bonCdeController.envoiMailEdition(edition, 'DUPLICATA', 'false')}" -->
<!-- 					         oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()"> -->
<!-- 							</p:menuitem > -->
<!-- 					   </c:forEach> -->
<!-- 				</p:submenu> -->
				
				<p:separator />
				
				<p:menuitem  title="Envoyer par email en brouillon" value="Brouillon" icon="fa fa-paper-plane"
				disabled="#{bonCdeController.etatBouton('modifier') or bonCdeController.selectedDocumentDTO.estMisADisposition}"
				oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()"
				update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@form,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"
				actionListener="#{bonCdeController.envoiMailEdition(null, 'BROUILLON', 'false')}">
				</p:menuitem >
				<p:submenu label="Tous les modèles" disabled="#{bonCdeController.etatBouton('modifier') or bonCdeController.selectedDocumentDTO.estMisADisposition}">
					 <c:forEach items="#{bonCdeController.listeEdition}" var="edition" varStatus="loop">
					       <p:menuitem  title="#{edition.libelleEdition}" value="#{edition.libelleEdition}"
					        actionListener="#{bonCdeController.envoiMailEdition(edition, 'BROUILLON', 'false')}"
					         oncomplete="$('.classHiddenCommandForDialogEmailReturnBoncde').click()">
							</p:menuitem >
					   </c:forEach>
				</p:submenu>
				
		</p:submenu>

		<p:separator styleClass="separateur-menu-vertical" />

		<p:menuitem title="#{c_boncommande.titre_menu_afficher_liste}" styleClass="icon icon-liste" oncomplete="PF('wvOverlayListeBoncde').show();"/>		
		
		<p:separator styleClass="separateur-menu-vertical" />		
		
		<p:menuitem title="Documents liés" styleClass="icon icon-documents-lies"  rendered="#{auth.isDevLgr()}"
			oncomplete="$('.classHiddenCommandForDialogDocumentLieReturnbonCde').click()"
			process="@this" 
			update="@this" 
			disabled="#bonCdeController.etatBouton('imprimer') }" />
				
	</p:menubar>

	<p:commandButton styleClass="classHiddenCommandForDialogAgendaReturnBoncde" actionListener="#{bonCdeController.actDialogEvenement}" style="display:none" process="@this"  >
        <p:ajax event="dialogReturn" update="@widgetVar(wvAgenda)"  />  
    </p:commandButton>    
    
	<p:commandButton styleClass="classHiddenCommandForDialogEmailReturnBoncde" actionListener="#{bonCdeController.actDialogEmailSelectedEdition}" style="display:none" process="@this"  >
        <p:ajax event="dialogReturn" listener="#{bonCdeController.handleReturnDialogEmail}" update=":form:messages, idTableauComplementaireBoncde"  />  
    </p:commandButton>
                
    <p:commandButton styleClass="classHiddenCommandForDialogDocumentLieReturnbonCde" actionListener="#{bonCdeController.actDialogGenerationDocumentLie}" style="display:none" process="@this"  >
        <p:ajax event="dialogReturn" update="@form"  listener="#{bonCdeController.handleReturnDialogDocumentLie}"/>  
    </p:commandButton> 
        
	<p:overlayPanel widgetVar="wvAideMenuBoncde" hideEffect="fade"
								dynamic="true" showCloseIcon="true"
								styleClass="overlay-aide-contextuelle overlay-aide-contextuelle-big">
								<ui:include src="/aide_contextuelle/bc_general.xhtml" />
	</p:overlayPanel>

	<p:fieldset style="margin-bottom:20px;" id="idTableauComplementaireBoncde" widgetVar="wvTableauComplementaireBoncde">
		<h:panelGrid columns="9" cellpadding="15">
			<p:panel styleClass="panel-aide-contextuelle">
				<p:commandButton process="@this" 
				alt="#{const_vue.btn_generation_modele}"
				title="#{const_vue.btn_generation_modele}" 
				label="#{const_vue.btn_generation_modele}" 
				value="#{const_vue.btn_generation_modele}"

				icon="ui-icon-copy"
					action="#{duplicationDocumentBean.actDialogGenerationModeleDocument}" disabled="#{bonCdeController.modeEcran.dataSetEnModif()}">
						<f:setPropertyActionListener target="#{duplicationDocumentBean.doc}" value="#{bonCdeController.masterEntity}"/>
						<p:ajax event="dialogReturn" listener="#{duplicationDocumentBean.handleReturnDialogGenerationDocument}" 
						update=":form:tabView,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)" oncomplete="activeTabCenter('#{bonCdeController.css}');" />
				</p:commandButton>
				<p:commandLink id="idLinkAideGenerationModeleDocumentBoncde"
					styleClass="lien-aide-contextuelle">
					<i class="fa fa-info-circle animated"></i>
				</p:commandLink>

				<p:overlayPanel for="idLinkAideGenerationModeleDocumentBoncde"
					hideEffect="fade" dynamic="true" showCloseIcon="true"
					styleClass="overlay-aide-contextuelle">
					<ui:include
						src="/aide_contextuelle/document_generation_modele_document.xhtml" />
				</p:overlayPanel>
			</p:panel>
			<p:separator/>
			<p:panel styleClass="panel-aide-contextuelle">
				<p:commandButton process="@this" 
					alt="#{const_vue.btn_generation_document}" 
					title="#{const_vue.btn_generation_document}"
					label="#{const_vue.btn_generation_document}" 
					value="#{const_vue.btn_generation_document}"
				icon="ui-icon-link"
					action="#{duplicationDocumentBean.actDialogGenerationDocument}" disabled="#{bonCdeController.modeEcran.dataSetEnModif()}">
					<f:setPropertyActionListener target="#{duplicationDocumentBean.doc}" value="#{bonCdeController.masterEntity}"/>	
					<f:setPropertyActionListener target="#{duplicationDocumentBean.genereToutesLesLignes}" value="true"/>
						<p:ajax event="dialogReturn" listener="#{duplicationDocumentBean.handleReturnDialogGenerationDocument}" 
						update=":form:tabView,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)" oncomplete="activeTabCenter('#{bonCdeController.css}');" />
				</p:commandButton>
				<p:commandLink id="idLinkAideGenerationDocumentBc"
					styleClass="lien-aide-contextuelle">
					<i class="fa fa-info-circle animated"></i>
				</p:commandLink>

				<p:overlayPanel for="idLinkAideGenerationDocumentBc" hideEffect="fade"
					dynamic="true" showCloseIcon="true"
					styleClass="overlay-aide-contextuelle">
					<ui:include
						src="/aide_contextuelle/document_generation_document.xhtml" />
				</p:overlayPanel>
			</p:panel>
			<!-- 							<p:separator styleClass="separateur-menu-vertical"/> -->
			<!-- 							<p:panel> -->
			<!-- 							<p:outputLabel value="CA HT : " /> -->
			<!-- 							</p:panel> -->
			<!-- 							<p:panel> -->
			<!-- 							<p:outputLabel value="150 €" /> -->
			<!-- 							</p:panel> -->
			<!-- 							<p:separator styleClass="separateur-menu-vertical"/> -->
			<!-- 							<p:panel> -->
			<!-- 							<p:outputLabel value="CA HT : " /> -->
			<!-- 							</p:panel> -->
			<!-- 							<p:panel> -->
			<!-- 							<p:outputLabel value="150 €" /> -->
			<!-- 							</p:panel> -->
					<p:outputLabel value="Etat du document  " rendered="#{auth.isDevLgr()}"/>
						<p:panel styleClass="panel-aide-contextuelle">
							<p:autoComplete value="#{bonCdeController.selectedEtatDocument}" rendered="#{auth.isDevLgr()}"
								converter="entityConverter"
								completeMethod="#{bonCdeController.etatAutoComplete}"
								disabled="true" var="etat"
								itemLabel="#{etat.codeEtat}" itemValue="#{etat}"
								forceSelection="true" dropdown="true" placeholder="Etat du document">
								<p:column>
									<h:outputText value="#{etat.codeEtat}" />
								</p:column>

								<p:column>
									<h:outputText value="#{etat.liblEtat}" />
								</p:column>

								<f:attribute name="nomChamp" value="#{const.C_CODE_ETAT}" />
								  <p:ajax event="clear" listener="#{bonCdeController.onClearEtat}" 
								 	update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(#{bonCdeController.wvEcran}),@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"/>
								<p:ajax event="itemSelect"
									listener="#{bonCdeController.autcompleteSelection}"
									update="idPanelEnteteBoncde,idPanelLignesBoncde,idTableauComplementaireBoncde,:form:messages,@widgetVar(#{bonCdeController.wvEcran}),@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)"/>
							</p:autoComplete>
						</p:panel>				
					<h:outputLabel value="Document mis à la disposition du client !!!" title="#{bonCdeController.documentDTOEstVerrouille().message}" rendered="#{bonCdeController.documentDTOEstVerrouille().verrouille}"/>			
					
					<p:outputLabel value="précision prix : " rendered="#{bonCdeController.affichagePrecisionPrixDocument()}"/>
					<p:outputLabel value="#{bonCdeController.masterEntity.nbDecimalesPrix} décimale(s)" style="font-weight: bold;" id="idPrecisionPrixBcde" 
					rendered="#{bonCdeController.affichagePrecisionPrixDocument()}"/>
					
<!-- 					<p:outputLabel value="Empreinte CB prise #{bonCdeController.paiementParCarteEnAttente.idExterne}" style="font-weight: bold;" id="idPrecisionPrixPanier"  -->
<!-- 					rendered="#{bonCdeController.paiementParCarteEnAttente!=null}"/> -->
		</h:panelGrid>
	</p:fieldset>
	
	<!-- 	<div class="ui-grid ui-grid-responsive"> -->
	<!-- 		<div class="ui-grid-row"> -->
	<!-- 			<div class="ui-grid-col-12"> -->
<!-- 	flowListener="#{bonCdeController.onFlowProcess}" -->

	<p:wizard nextLabel="#{const_vue.btn_suivant}" backLabel="#{const_vue.btn_precedent}" binding="#{bonCdeController.wizardDocument}" step="#{bonCdeController.stepCourant()}"
	showStepStatus="false" widgetVar="widgetVarLigneBoncde" flowListener="#{bonCdeController.handleFlow}" >
<p:tab id="idSyntheseBoncde" title="Synthèse du bon de commande">
			<div class="card">
				<p:panel header="Synthèse du bon de commande" style="width:100%;" rendered="#{!bonCdeController.selectedDocumentDTO.BoncdeEstVide()}">
					<p:panelGrid columns="3" id="idInfosBoncde" columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4" styleClass="ui-panelgrid-blank" layout="grid">
						<h:panelGroup>
						<p:outputLabel value="Code bon commande : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.codeDocument}" />
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="Code tiers : " style="font-weight: bold;"/>
							<p:commandLink 	value="#{bonCdeController.selectedDocumentDTO.codeTiers}"
											style="font-weight: bold;" 
											action="#{bonCdeController.ouvertureTiersBean.detailTiers(bonCdeController.ouvertureTiersBean.recupCodetiers(bonCdeController.selectedDocumentDTO.codeTiers))}" update=":form:tabView"
											oncomplete="activeTabCenter('#{bonCdeController.ouvertureTiersBean.event.cssLgrTab}');">
							</p:commandLink>						
<!-- 						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.codeTiers}"/> -->
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="Adresse facturation : " style="font-weight: bold;"/>
<!-- 						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.dateDocument}" > -->
<!-- 							<f:convertDateTime pattern="#{msg.date_pattern}" timeZone="#{msg.time_zone}"/> -->
<!-- 						</p:outputLabel> -->
						</h:panelGroup>
						
						<h:panelGroup>
<!-- 						<p:outputLabel value="Libellé : "/> -->
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.libelleDocument}" />
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="Entreprise : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.nomEntreprise}"/>
						<br />
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.nomTiers} - #{bonCdeController.selectedDocumentDTO.prenomTiers}"/>
<!-- 						<hr/> -->
<!-- 						<h:panelGroup> -->
<!-- 						<p:outputLabel value="Coordonnées : " style="font-weight: bold;"/> -->
<!-- 						<p:outputLabel value="#{bonCdeController.selectedInfosTiers.adresseEmail} - #{bonCdeController.selectedInfosTiers.numeroTelephone}"/> -->
<!-- 						</h:panelGroup> -->
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="" style="font-weight:bold;"/>
						<p:outputLabel value="#{bonCdeController.taAdresseFact.adresse1Adresse}" >
						</p:outputLabel>
						<br/>
						<p:outputLabel value="#{bonCdeController.taAdresseFact.adresse2Adresse}" >
						</p:outputLabel>
						</h:panelGroup>

						<h:panelGroup>
						<p:outputLabel value="Date bon commande : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.dateDocument}" >
							<f:convertDateTime pattern="#{msg.date_pattern}" timeZone="#{msg.time_zone}"/>
						</p:outputLabel>
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="Tèl : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.taTiersDTO.numeroTelephone}"/>
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="" style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.taAdresseFact.adresse3Adresse}" >
<!-- 						<p:outputLabel value="#{bonCdeController.taAdresseFact.codepostalAdresse} #{bonCdeController.taAdresseFact.villeAdresse}" > -->
<!-- 							<f:convertDateTime pattern="#{msg.date_pattern}" timeZone="#{msg.time_zone}"/> -->
						</p:outputLabel>
						</h:panelGroup>
						
						<h:panelGroup>
						<p:outputLabel value=""/>
						<p:outputLabel value="" >
						</p:outputLabel>
						</h:panelGroup>
						
						<h:panelGroup>
						<p:outputLabel value="Email : " style="font-weight: bold;"/>
						<p:commandLink update=":form:messages" actionListener="#{bonCdeController.actDialogEmail}">
        						<h:outputText value="#{bonCdeController.taTiersDTO.adresseEmail}" />
    						</p:commandLink>
						</h:panelGroup>
						<h:panelGroup>
						<p:outputLabel value="Ville : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.taAdresseFact.codepostalAdresse} #{bonCdeController.taAdresseFact.villeAdresse}" >
<!-- 							<f:convertDateTime pattern="#{msg.date_pattern}" timeZone="#{msg.time_zone}"/> -->
						</p:outputLabel>
						</h:panelGroup>
								
																								
						<h:panelGroup>
						<p:outputLabel value="N° commande externe : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.numeroCommandeFournisseur}" >
						</p:outputLabel>
						</h:panelGroup>						
						<h:panelGroup>
						<p:outputLabel value=""/>
						<p:outputLabel value="" >
						</p:outputLabel>
						</h:panelGroup>
															
						<h:panelGroup>
						<p:outputLabel value="Transporteur : " style="font-weight: bold;"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.codeTransporteur}" >
						</p:outputLabel>
						</h:panelGroup>
																		
																		
  						<h:panelGroup> 
						<div class="card" style="background:#ebebeb;text-align:center;center;padding: 5px;margin-top: 15px;">
						<p:outputLabel value="Net TTC" style="font-weight: bold;"/>
						<p:separator style="color:#9a9a9a"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.netTtcCalc}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:outputLabel>
<!-- 						<hr /> -->
						</div>
						</h:panelGroup>

						
						
						<h:panelGroup rendered="#{bonCdeController.paiementParCarteEnAttente!=null}">
						<div class="card" style="background:#ebebeb;text-align:center;center;padding: 5px;margin-top: 15px;">
					
						<p:outputLabel value="Montant max. empreinte CB (#{bonCdeController.paiementParCarteEnAttente.idExterne})  " style="font-weight: bold;"/>
						<p:separator style="color:#9a9a9a"/>
						<p:outputLabel value="#{bonCdeController.paiementParCarteEnAttente.amountCapturable}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:outputLabel>
						</div>
						</h:panelGroup>
						
						<h:panelGroup rendered="#{bonCdeController.paiementParCarteEnAttente==null}">
						<div class="card" style="background:#ebebeb;text-align:center;center;padding: 5px;margin-top: 15px;">
					
						<p:outputLabel value="Déjà réglé : " style="font-weight: bold;"/>
						<p:separator style="color:#9a9a9a"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.regleDocument}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:outputLabel>
						</div>
						</h:panelGroup>
<!-- 						</h:panelGroup> -->
<!--border-style: solid;border-width: thin;padding: 7px; -->
						<h:panelGroup>
						<div class="card" style="background: #ebf9cc;text-align: center;padding: 5px;margin-top: 15px;">
						<p:outputLabel value="Reste à régler" style="font-weight: bold;"/>
						<p:separator style="color:#9a9a9a"/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.resteAReglerComplet}" style="font-weight: bold;" >
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:outputLabel>
<!-- 						<hr /> -->
						</div>
						</h:panelGroup>
					</p:panelGrid>
<!-- Début détail ligne synthèse					 -->
					<p:dataTable id="iddataTableLigneBoncdeSynthese" 
					var="ligne"
					scrollable="true"
					scrollHeight="250"					
					widgetVar="widgetVarDataTableLigneBoncdeSynthese"
					
					value="#{bonCdeController.valuesLigne}"
					rowKey="#{ligne.dto.numLigneLDocument}"
					styleClass="datatable mt10 myclassBoncde">
					
										
					
					<p:ajax event="toggleSelect" process="@this" />
					<p:ajax event="rowToggle" process="@this" oncomplete="ligneSeperationExpend()" />
					
					<p:column style="width:8px" styleClass="center" >
						<p:rowToggler  rendered="#{ligne.ligneLieeFils!=null or ligne.ligneLieeMere!=null or ligne.ligneAbonnement!=null}"/>
					</p:column>
					
					<p:column style="width:10%">
						<f:facet name="header">
							<h:outputText value="Code article" />
						</f:facet>
				<p:commandLink 	value="#{ligne.taArticle.codeArticle}"
						action="#{bonCdeController.ouvertureArticleBean.detailArticle(bonCdeController.ouvertureArticleBean.recupCodeArticle(ligne.taArticle.codeArticle))}" update=":form:tabView"
						oncomplete="activeTabCenter('#{bonCdeController.ouvertureArticleBean.event.cssLgrTab}');">
				</p:commandLink>	
<!-- 								<h:outputText value="#{ligne.taArticle.codeArticle}"/> -->
					</p:column >
					
					<p:column style="width:24%">
						<f:facet name="header">
							<h:outputText value="Libellé" />
						</f:facet>
								<h:outputText value="#{ligne.dto.libLDocument}" id="idListeSyntheseLibelleBoncde"/>
								<p:tooltip id="toolTipListeSyntheseLibelleBoncde" value="#{ligne.dto.libLDocument}" shared="true" for="idListeSyntheseLibelleBoncde" showEffect="clip" position="top"/>
					</p:column>

					<p:column  style="width:8%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Qté 1" />
						</f:facet>
								<h:outputText value="#{ligne.dto.qteLDocument}"/>	
					</p:column>

					<p:column style="width:5%" styleClass="center">
						<f:facet name="header">
							<h:outputText value="U1" />
						</f:facet>

								<h:outputText value="#{ligne.taUnite1.codeUnite}" />
					</p:column>

					<p:column  style="width:8%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Qté 2" />
						</f:facet>
							<h:outputText value="#{ligne.dto.qte2LDocument}" id="idqte2LBoncdeSynthese"/>
					</p:column>

					<p:column style="width:5%" styleClass="center">
						<f:facet name="header">
							<h:outputText value="U2" />
						</f:facet>
								<h:outputText value="#{ligne.taUnite2.codeUnite}"/>
					</p:column>
					
					<p:column style="width:8%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Prix unitaire" />
						</f:facet>
								<h:outputText value="#{ligne.dto.prixULDocument}">
									<f:convertNumber type="currency"  minFractionDigits="#{bonCdeController.prefNbDecimalesPrix}" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
					</p:column>
					
					<p:column style="width:5%" styleClass="right" >
						<f:facet name="header">
							<h:outputText value="Remise %" />
						</f:facet>
								<h:outputText value="#{ligne.dto.remTxLDocument}" />
					</p:column>
					
					<p:column style="width:20%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Montant HT" />
						</f:facet>
								<h:outputText value="#{ligne.dto.mtHtLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
					</p:column>
					
					<p:column style="width:5%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="TVA"/>
						</f:facet>
								<h:outputText value="#{ligne.dto.codeTvaLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
					</p:column>
					
					<p:column style="width:20%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Montant TTC" />
						</f:facet>
								<h:outputText value="#{ligne.dto.mtTtcLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
					</p:column>
					
					<p:column style="width:5%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Remise globale" />
						</f:facet>
								<h:outputText value="#{ligne.dto.txRemHtDocument}" disabled="true">
								</h:outputText>
					</p:column>
					
					<p:column style="width:5%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Qté CRD" rendered="#{bonCdeController.gestionCapsules}"/>
						</f:facet>
								<h:outputText value="#{ligne.dto.qteTitreTransport}" disabled="true" rendered="#{bonCdeController.gestionCapsules}">
								</h:outputText>
					</p:column>
					
					
					<p:column style="width:5%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Titre CRD" rendered="#{bonCdeController.gestionCapsules}"/>
						</f:facet>
								<h:outputText value="#{ligne.dto.codeTitreTransport}" disabled="true" rendered="#{bonCdeController.gestionCapsules}">
								</h:outputText>
					</p:column>

					<p:column style="width:1%">
						<f:facet name="header">
							<h:outputText value="Etat" />
						</f:facet>
								<h:outputText value="#{ligne.codeEtat}"  id="idListeSyntheseEtat#{variableEcran}"/>
								<p:tooltip  value="#{ligne.codeEtat.concat(ligne.libelleEtat)}" shared="true" for="idListeSyntheseEtat#{variableEcran}" showEffect="clip" position="top"/>
					</p:column>					
										
					<p:rowExpansion>

					<p:panelGrid columns="2"  columnClasses="ui-grid-col-6,ui-grid-col-6" styleClass="ui-panelgrid-blank" layout="grid" rendered="#{ligne.ligneLieeFils!=null or ligne.ligneLieeMere!=null}">
					<p:panel header="document ayant servi à générer le document courant" style="width:100%;" >
						<p:dataTable value="#{ligne.ligneLieeMere}" id="dataTableLigneLieeMere" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneLieeMere" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailDocument(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>
								<!-- 								<h:outputText value="#{lien.codeDocumentDest}" /> -->
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="lot" />
								</f:facet>
								<h:outputText value="#{lien.numLot}" />
							</p:column>
							<p:column styleClass="right">
								<f:facet name="header">
									<h:outputText value="Qté. reçue" />
								</f:facet>
								<h:outputText value="#{lien.qteRecue}" />
							</p:column>
<!-- 							<p:column> -->
<!-- 								<f:facet name="header"> -->
<!-- 									<h:outputText value="Etat" /> -->
<!-- 								</f:facet> -->
<!-- 								<h:outputText value="#{lien.etat}" /> -->
<!-- 							</p:column>							 -->

						</p:dataTable>
						</p:panel>
						<p:panel header="document généré à partir du document courant" style="width:100%;" >
						<p:dataTable value="#{ligne.ligneLieeFils}" id="dataTableLigneLieeFils" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneLieeFils" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailDocument(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>
								<!-- 								<h:outputText value="#{lien.codeDocumentDest}" /> -->
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="lot" />
								</f:facet>
								<h:outputText value="#{lien.numLot}" />
							</p:column>
							<p:column styleClass="right">
								<f:facet name="header">
									<h:outputText value="Qté. reçue" />
								</f:facet>
								<h:outputText value="#{lien.qteRecue}" />
							</p:column>
<!-- 							<p:column> -->
<!-- 								<f:facet name="header"> -->
<!-- 									<h:outputText value="Etat" /> -->
<!-- 								</f:facet> -->
<!-- 								<h:outputText value="#{lien.etat}" /> -->
<!-- 							</p:column>							 -->

						</p:dataTable>
						</p:panel>
					</p:panelGrid>
					<p:panel header="Infos de l'abonnement" style="width:100%;" rendered="#{ligne.ligneAbonnement!=null}">
						<p:dataTable value="#{ligne.ligneAbonnement}" id="dataTableLigneAbonnement" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneAbonnement" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">
								<p:column  style="width:80px" >
									<p:commandButton value="" actionListener="#{bonCdeController.actDialogDetailLigneAbonnement}" process="@this"
										styleClass="icon-medium icon-reglement" title="Détail de la ligne d'abonnement">
										<f:attribute name="taLigneALigneEcheanceDTO" value="#{lien}" />
										<p:ajax event="dialogReturn" listener="#{bonCdeController.handleReturnDialogDetailLigneAbonnement}" />
									</p:commandButton>
								</p:column>

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailAbonnement(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>

							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
						</p:dataTable>
</p:panel>

					</p:rowExpansion>

					

				</p:dataTable>
<!-- Fin détail ligne synthèse					 -->
					<p:panelGrid columns="1" id="idInfosCommentaireBoncde" columnClasses="ui-grid-col-4" styleClass="ui-panelgrid-blank" layout="grid">
						<h:panelGroup>
						<p:outputLabel value="Commentaires" style="font-weight: bold;"/>
						<br/>
						<p:outputLabel value="#{bonCdeController.selectedDocumentDTO.commentaire}" />
						</h:panelGroup>
					</p:panelGrid>
				</p:panel>
			</div>
		</p:tab>
		<p:tab id="idEnteteBoncde" title="Entête" >
		
			<p:panel id="idPanelEnteteBoncde" header="#{const_vue.titre_panel_entete}" toggleable="true" widgetVar="panelEnteteBoncde" >
				<f:facet name="actions">
				<p:commandLink id="idLinkAideEnteteBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideEnteteBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/document_entete_document.xhtml" />
					</p:overlayPanel>
        		</f:facet>
        		<h:panelGrid columns="2" cellpadding="10" >
					
					<p:outputLabel value="Code bon commande : " styleClass="labelchob" />
					<p:panel styleClass="panel-aide-contextuelle">
						<p:inputText id="idCodeBoncde"
							styleClass=""
							value="#{bonCdeController.selectedDocumentDTO.codeDocument}"
							validator="#{bonCdeController.validateDocument}"
							disabled="#{bonCdeController.editableEnInsertionUniquement()}">
							<f:attribute name="nomChamp" value="#{const.C_CODE_DOCUMENT}" />
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:commandLink id="idLinkAideCodeBoncde" styleClass="lien-aide-contextuelle" >
							<i class="fa fa-info-circle animated swing"></i>
						</p:commandLink>
						<p:overlayPanel for="idLinkAideCodeBoncde" hideEffect="fade" dynamic="true" showCloseIcon="true" styleClass="overlay-aide-contextuelle">
							<ui:include src="/aide_contextuelle/document_code_document.xhtml" />
						</p:overlayPanel>
					</p:panel>
					
					<p:outputLabel value="Code tiers : " styleClass="labelchob"/>
					
					<p:focus>
					
						<p:panel styleClass="panel-aide-contextuelle">
							<p:autoComplete value="#{bonCdeController.taTiersDTO}"
							       id="idtiersBoncde" converter="entityConverter"
								completeMethod="#{bonCdeController.tiersAutoCompleteDTOLight}"
								required="false" requiredMessage="#{msg_diag.alert_champs_obligatoir}"
								disabled="#{bonCdeController.editable()}" var="tiers"
								itemLabel="#{tiers.codeTiers}" itemValue="#{tiers}"
								forceSelection="true" dropdown="true" placeholder="Tiers" >
								<p:column>
									<h:outputText value="#{tiers.codeTiers}" required="true" requiredMessage="#{msg_diag.alert_champs_obligatoir}"/>
								</p:column>
								
								<p:column>
									<h:outputText value="#{tiers.nomTiers}" />
								</p:column>

								<p:column>
									<h:outputText value="#{tiers.prenomTiers}" />
								</p:column>

								<p:column>
									<h:outputText value="#{tiers.nomEntreprise}" />
								</p:column>

				
								<f:attribute name="nomChamp" value="#{const.C_CODE_TIERS}" />
								<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" 
								update="idNomTiersBoncde,idLibellePieceBoncde,idTTCBoncde,idLocalisationTvaDocBoncde,idDateEchBoncde,@this,@widgetVar(panelAdresseFacturationBoncde),@widgetVar(panelAdresseLivraisonBoncde),
								@widgetVar(panelConditionPaiementBoncde),idPanelGroupInfosTiersEnteteBonCde,@widgetVar(panelInfosLivraisonSuppBoncde)" />
							</p:autoComplete>
							<p:commandLink id="idLinkAideCodeTiers" styleClass="lien-aide-contextuelle">
								<i class="fa fa-info-circle animated swing"></i>
							</p:commandLink>

							<p:overlayPanel for="idLinkAideCodeTiers" hideEffect="fade" dynamic="true" showCloseIcon="true" styleClass="overlay-aide-contextuelle" >
									<ui:include src="/aide_contextuelle/document_code_tiers.xhtml" />
							</p:overlayPanel>
						</p:panel>
						
					</p:focus>
					
					<p:outputLabel value="Nom Tiers : "  styleClass="labelchob"/>
					<p:panel styleClass="panel-aide-contextuelle">
					<p:inputText
						value="#{bonCdeController.selectedDocumentDTO.nomTiers}" id="idNomTiersBoncde"
						validator="#{bonCdeController.validateDocument}" 
						disabled="#{bonCdeController.editable()}">
						<f:attribute name="nomChamp" value="#{const.C_NOM_TIERS}" />
						<p:ajax event="blur" update="@this" />
					</p:inputText>
					<p:commandLink id="idLinkAideNomTiersBc"
							styleClass="lien-aide-contextuelle">
							<i class="fa fa-info-circle animated swing"></i>
						</p:commandLink>

						<p:overlayPanel for="idLinkAideNomTiersBc" hideEffect="fade"
							dynamic="true" showCloseIcon="true"
							styleClass="overlay-aide-contextuelle">
							<ui:include src="/aide_contextuelle/document_nom_tiers.xhtml" />
						</p:overlayPanel>
					</p:panel>
					
					<p:outputLabel value="Date bon commande : " />
					<p:panel styleClass="panel-aide-contextuelle">
					<p:calendar
						value="#{bonCdeController.selectedDocumentDTO.dateDocument}"
						pattern="dd/MM/yyyy" mask="true" locale="fr" navigator="true"  showOn="button"  timeZone="#{msg.time_zone}" 
						mindate="#{bonCdeController.dateMin}"
						maxdate="#{bonCdeController.dateMax}"
						disabled="#{bonCdeController.editable()}">
						
						<f:attribute name="nomChamp" value="#{const.C_DATE_DOCUMENT}" />
						<p:ajax event="dateSelect" listener="#{bonCdeController.controleDate}" update="@this,idDateEchBoncde" />
						<p:ajax event="change" listener="#{bonCdeController.controleDate}"  update="@this,idDateEchBoncde" />
					</p:calendar>
					<p:commandLink id="idLinkAideDateBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideDateBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/document_date_document.xhtml" />
					</p:overlayPanel>
					</p:panel>
					
					<p:panel styleClass="panel-aide-contextuelle">
					<p:outputLabel value="Libellé : " />
					<p:commandLink id="idLinkAideLibelleBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideLibelleBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/document_libelle_document.xhtml" />
					</p:overlayPanel>
					</p:panel>
					
					<p:inputText
						value="#{bonCdeController.selectedDocumentDTO.libelleDocument}" id="idLibellePieceBoncde"
						validator="#{bonCdeController.validateDocument}" style="width:300%"
						disabled="#{bonCdeController.editable()}">
						<f:attribute name="nomChamp" value="#{const.C_LIBELLE_DOCUMENT}" />
						<p:ajax event="blur" update="@this" />
					</p:inputText>
					
					<p:outputLabel value="TTC : " />
					<p:panel styleClass="panel-aide-contextuelle">
					<p:selectBooleanCheckbox
						value="#{bonCdeController.selectedDocumentDTO.ttc}" id="idTTCBoncde" 
						disabled="#{bonCdeController.disableTtc() or bonCdeController.disableTtcSiDocSansTVA()}">
						<f:attribute name="nomChamp" value="#{const.C_TTC}" />
						<p:ajax event="change" update="@this" />
					</p:selectBooleanCheckbox>
					<p:commandLink id="idLinkAideSaisieTtcBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideSaisieTtcBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/document_saisiettc_document.xhtml" />
					</p:overlayPanel>
					</p:panel>
										
										<p:outputLabel value="" id="idDateEchBoncde"/><!-- Label vide avec l'ID précédent pour ne pas supprimer cet id dans tous les updates tant que la supression de ce champ n'est totalement valide -->
										<p:outputLabel value="" />
<!-- 					<p:outputLabel value="Date de validité : " /> -->
<!-- 					<p:panel styleClass="panel-aide-contextuelle"> -->
<!-- 					<p:calendar -->
<!-- 						value="#{bonCdeController.selectedDocumentDTO.dateEchDocument}" id="idDateEchBoncde" -->
<!-- 						pattern="dd/MM/yyyy" mask="true" locale="fr" navigator="true"  showOn="button" timeZone="#{msg.time_zone}"  -->
<!-- 						disabled="#{bonCdeController.editable()}"> -->
						
<!-- 						<f:attribute name="nomChamp" value="#{const.C_DATE_ECH_DOCUMENT}" /> -->
<!-- 						<p:ajax event="dateSelect" listener="#{bonCdeController.controleDate}" update="@this" /> -->
<!-- 						<p:ajax event="change" listener="#{bonCdeController.controleDate}"  update="@this" /> -->
<!-- 					</p:calendar> -->
<!-- 					<p:commandLink id="idLinkAideDateEcheanceBc" -->
<!-- 						styleClass="lien-aide-contextuelle"> -->
<!-- 						<i class="fa fa-info-circle animated"></i> -->
<!-- 					</p:commandLink> -->

<!-- 					<p:overlayPanel for="idLinkAideDateEcheanceBc" hideEffect="fade" -->
<!-- 						dynamic="true" showCloseIcon="true" -->
<!-- 						styleClass="overlay-aide-contextuelle"> -->
<!-- 						<ui:include src="/aide_contextuelle/document_date_validite_document.xhtml" /> -->
<!-- 					</p:overlayPanel> -->
<!-- 					</p:panel> -->
										
					<p:outputLabel value="Date de livraison souhaitée : " />
					<p:calendar
						value="#{bonCdeController.selectedDocumentDTO.dateLivDocument}"
						pattern="dd/MM/yyyy" mask="true" locale="fr" navigator="true" showOn="button"  timeZone="#{msg.time_zone}" 
						validator="#{bonCdeController.validateDocument}"
						disabled="#{bonCdeController.editable()}">
						
						<f:attribute name="nomChamp" value="#{const.C_DATE_LIV_DOCUMENT}" />
						<p:ajax event="dateSelect" update="@this" />
						<p:ajax event="change"  update="@this"/>
					</p:calendar>
					
<!-- 					<p:outputLabel value="Localisation TVA : " /> -->
<!-- 					<p:selectOneMenu id="console" value="#{bonCdeController.selectedDocumentDTO.commentaire}" style="width:125px"> -->
<!-- 			            <f:selectItem itemLabel="Client en France" itemValue="fr" /> -->
<!-- 			        </p:selectOneMenu> -->
			        
			        <p:outputLabel value="Localisation TVA : " />
					<p:panel styleClass="panel-aide-contextuelle">
						<p:autoComplete value="#{bonCdeController.taTTvaDoc}" id="idLocalisationTvaDocBoncde"
							converter="entityConverter" disabled="#{bonCdeController.editable() or bonCdeController.disableTtc()}"
							completeMethod="#{bonCdeController.typeTvaDocAutoComplete}"
							var="tp" itemLabel="#{tp.codeTTvaDoc}" itemValue="#{tp}"
							forceSelection="true" dropdown="true"
							placeholder="Localisation TVA">
							<p:column>
								<h:outputText value="#{tp.codeTTvaDoc}" />
							</p:column>
							<p:column>
								<h:outputText value="#{tp.libelleTTvaDoc}" />
							</p:column>
							<f:attribute name="nomChamp" value="#{const.C_CODE_T_TVA_DOC}" />
							<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" update="idTTCBoncde"/>
						</p:autoComplete>
					<p:commandLink id="idLinkAideLocalidationTvaBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideLocalidationTvaBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/document_localisationtva_document.xhtml" />
					</p:overlayPanel>
					</p:panel>
<!-- 					<p:outputLabel value="Observation : " /> -->
<!-- 					<p:inputTextarea -->
<!-- 						value="#{bonCdeController.selectedDocumentDTO.commentaire}" -->
<!-- 						validator="#{bonCdeController.validateDocument}" style="width:300%" -->
<!-- 						disabled="#{bonCdeController.editable()}"> -->
<!-- 						<f:attribute name="nomChamp" value="#{const.C_COMMENTAIRE}" /> -->
<!-- 						<p:ajax event="blur" update="@this" /> -->
<!-- 					</p:inputTextarea> -->

			        
<!-- 				<p:commandButton  process="@this" title="Génération modèle"  -->
<!-- 						styleClass="btn-generation-modele btn" actionListener="#{bonCdeController.actDialogGenerationModeleDocument}" > -->
<!-- 						<p:ajax event="dialogReturn" listener="#{bonCdeController.handleReturnDialogGenerationDocument}"  -->
<!-- 						update=":form:tabView,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)" oncomplete="activeTabCenter('#{bonCdeController.css}');" /> -->
<!-- 				</p:commandButton> -->
<!-- 				<p:commandButton process="@this" title="Génération document"  -->
<!-- 						styleClass="btn-generation-document btn" actionListener="#{bonCdeController.actDialogGenerationDocument}" > -->
<!-- 						<p:ajax event="dialogReturn" listener="#{bonCdeController.handleReturnDialogGenerationDocument}"  -->
<!-- 						update=":form:tabView,@widgetVar(wvMenuListeBoncde),@widgetVar(wvDataTableListeBoncde)" oncomplete="activeTabCenter('#{bonCdeController.css}');" /> -->
<!-- 				</p:commandButton> -->

					<p:outputLabel value="Numéro commande externe : " />
					<p:inputText
						value="#{bonCdeController.selectedDocumentDTO.numeroCommandeFournisseur}"
						validator="#{bonCdeController.validateDocument}" 
						disabled="#{bonCdeController.editable()}">
						<f:attribute name="nomChamp" value="#{const.C_NUMERO_COMMANDE_FOURNISSEUR}" />
						<p:ajax event="blur" update="@this" />
					</p:inputText>
					
					<p:outputLabel value="Transporteur : " />
					<p:autoComplete value="#{bonCdeController.taTransporteurDTO}"
						converter="entityConverter"
						completeMethod="#{bonCdeController.transporteurAutoCompleteDTOLight}"
						disabled="#{bonCdeController.editable()}" var="transporteur"
						itemLabel="#{transporteur.codeTransporteur}" itemValue="#{transporteur}"
						forceSelection="true" dropdown="true" placeholder="Transporteur" >
						<p:column>
							<h:outputText value="#{transporteur.codeTransporteur}" required="true" requiredMessage="#{msg_diag.alert_champs_obligatoir}"/>
						</p:column>

						<p:column>
							<h:outputText value="#{transporteur.liblTransporteur}" />
						</p:column>
		
						<f:attribute name="nomChamp" value="#{const.C_CODE_TRANSPORTEUR}" />
						<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" update="@this" />
					</p:autoComplete>
					
								        
			        <p:outputLabel value="Avec gestion des unités de saisie : " />
					<p:inputSwitch value="#{bonCdeController.selectedDocumentDTO.utiliseUniteSaisie}" onLabel="Oui" offLabel="Non" disabled="#{bonCdeController.editable()}">
			        </p:inputSwitch>
					

					<!-- Invisible, relier au meme champ que la checkbox du dernier step du wizard, reprise de cette valeur dans le 1er step car le oncomplete du actEnregistrer se declanche apres le retour au 1er, la valeur doit donc etre disponible ici pour le javascript -->
					<p:selectBooleanCheckbox value="#{bonCdeController.impressionDirect}" styleClass="invisible" disabled="#{bonCdeController.editable()}" widgetVar="wvImpressionDirectBoncde"/>

				</h:panelGrid>
				
        		
     		<div class="ui-g">
    		 <div class="ui-g-5">
				<p:panel id="idAdresseFacturationBoncde" header="#{const_vue.titre_panel_adresse_facturation}" toggleable="true" widgetVar="panelAdresseFacturationBoncde"
					collapsed="false">
					<h:panelGrid columns="2" cellpadding="10" id="idPanelAdresseFacBoncde">
						<p:outputLabel value="" />
						<p:selectOneMenu value="#{bonCdeController.taAdresseFact}" converter="entityConverter" var="t" filter="true" filterMatchMode="contains"
							disabled="#{bonCdeController.editable()}">
							<f:selectItems value="#{bonCdeController.listeAdresseInfosFacturationDTO}" var="tt" itemValue="#{t}" itemLabel="sélectionner une adresse" />
							<p:column>
								<h:outputText value="#{t.adresse1Adresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.adresse2Adresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.adresse3Adresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.codepostalAdresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.villeAdresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.paysAdresse}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.codeTAdr}" />
							</p:column>
							<p:ajax event="change" listener="#{bonCdeController.affecteAdrFactAutoComplete}" update="idPanelAdresseFacBoncde" />
						</p:selectOneMenu>


						<p:outputLabel value="Adresse 1" />
						<p:panel styleClass="panel-autocomplete">
							<p:inputText value="#{bonCdeController.selectedAdresseFact.adresse1Adresse}" disabled="#{bonCdeController.editable()}">
								<p:ajax event="blur" update="@this" />
							</p:inputText>
							<p:commandButton value="Raffraîchir" styleClass="icon-refresh btn" disabled="#{bonCdeController.editable()}"
								actionListener="#{bonCdeController.actReinitAdrFact}" process="@this" update="idPanelAdresseFacBoncde,idMenuBoutonBoncde" />
						</p:panel>

						<p:outputLabel value="Adresse 2" />
						<p:inputText value="#{bonCdeController.selectedAdresseFact.adresse2Adresse}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel  value="Adresse 3" />
						<p:inputText value="#{bonCdeController.selectedAdresseFact.adresse3Adresse}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Code postal" />
						<p:inputText value="#{bonCdeController.selectedAdresseFact.codepostalAdresse}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Ville" />
						<p:inputText value="#{bonCdeController.selectedAdresseFact.villeAdresse}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Pays" />
						<p:inputText value="#{bonCdeController.selectedAdresseFact.paysAdresse}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
					</h:panelGrid>
				</p:panel>
			</div>
			
			<div class="ui-g-5">
			
				<p:panel id="idAdresseLivraisonBoncde" header="Adresse de livraison" toggleable="true" widgetVar="panelAdresseLivraisonBoncde">
					<h:panelGrid columns="2" cellpadding="10" id="idPanelAdresseLivBoncde">

						<p:outputLabel value="" />
						<p:selectOneMenu value="#{bonCdeController.taAdresseLiv}" converter="entityConverter" var="t" filter="true" filterMatchMode="contains"
							disabled="#{bonCdeController.editable()}">
							<f:selectItems value="#{bonCdeController.listeAdresseInfosLivraisonDTO}" var="tt" itemValue="#{t}" itemLabel="sélectionner une adresse" />
							<p:column>
								<h:outputText value="#{t.adresse1AdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.adresse2AdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.adresse3AdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.codepostalAdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.villeAdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.paysAdresseLiv}" />
							</p:column>
							<p:column>
								<h:outputText value="#{t.codeTAdr}" />
							</p:column>
							<p:ajax event="change" listener="#{bonCdeController.affecteAdrLivAutoComplete}" update="idPanelAdresseLivBoncde" />
						</p:selectOneMenu>
					

						<p:outputLabel value="Adresse 1" />
						<p:panel styleClass="panel-autocomplete">
							<p:inputText value="#{bonCdeController.selectedAdresseLiv.adresse1AdresseLiv}" disabled="#{bonCdeController.editable()}">
								<p:ajax event="blur" update="@this" />
							</p:inputText>
							<p:commandButton value="Raffraîchir" styleClass="icon-refresh btn" disabled="#{bonCdeController.editable()}"
								actionListener="#{bonCdeController.actReinitAdrLiv}" process="@this" update="idPanelAdresseLivBoncde,idMenuBoutonBoncde" />
						</p:panel>
						<p:outputLabel value="Adresse 2" />
						<p:inputText value="#{bonCdeController.selectedAdresseLiv.adresse2AdresseLiv}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Adresse 3" />
						<p:inputText value="#{bonCdeController.selectedAdresseLiv.adresse3AdresseLiv}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Code postal" />
						<p:inputText value="#{bonCdeController.selectedAdresseLiv.codepostalAdresseLiv}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Ville" />
						<p:inputText value="#{bonCdeController.selectedAdresseLiv.villeAdresseLiv}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Pays" />
						<p:inputText value="#{bonCdeController.selectedAdresseLiv.paysAdresseLiv}" disabled="#{bonCdeController.editable()}">
							<p:ajax event="blur" update="@this" />
						</p:inputText>
					</h:panelGrid>
				</p:panel>
			</div>
		
			<div class="ui-g-2">
			
				<p:panel  header="infos livraison complémentaires" toggleable="true" widgetVar="panelInfosLivraisonSuppBoncde">
					<h:panelGrid columns="2" cellpadding="10" id="idPanelInfosLivSuppBoncde">

							<p:outputLabel value="infos Livraison : " />
							<p:inputTextarea  value="#{bonCdeController.selectedAdresseLiv.livraison}"
								 disabled="#{bonCdeController.editable()}">
								<f:attribute name="nomChamp" value="#{const.C_LIVRAISON}" />
								<p:ajax event="blur" update="@this" />
							</p:inputTextarea>

							<p:outputLabel value="latitude : " />
							<p:inputText  value="#{bonCdeController.selectedAdresseLiv.latitudeDec}"
							 disabled="#{bonCdeController.editable()}" >
								<f:attribute name="nomChamp" value="#{const.C_LATITUDE_DEC}" />
								<p:ajax event="blur" update="@this" />
							</p:inputText>

							<p:outputLabel value="longitude  : " />
							<p:inputText  value="#{bonCdeController.selectedAdresseLiv.longitudeDec}"
								disabled="#{bonCdeController.editable()}" >
								<f:attribute name="nomChamp" value="#{const.C_LONGITUDE_DEC}" />
								<p:ajax event="blur" update="@this" />
							</p:inputText>
					</h:panelGrid>
				</p:panel>
			</div>
		
		</div>

 				
				<p:panel id="idConditionPaiementBoncde" header="Conditon de paiement" toggleable="true" widgetVar="panelConditionPaiementBoncde" collapsed="true">
				<f:facet name="actions">
				<p:commandLink id="idLinkAideConditionPaiementBc"
						styleClass="lien-aide-contextuelle">
						<i class="fa fa-info-circle animated"></i>
					</p:commandLink>

					<p:overlayPanel for="idLinkAideConditionPaiementBc" hideEffect="fade"
						dynamic="true" showCloseIcon="true"
						styleClass="overlay-aide-contextuelle">
						<ui:include src="/aide_contextuelle/devis_condition_duree_validite_devis.xhtml" />
					</p:overlayPanel>
        		</f:facet>					
					
					<h:panelGrid columns="2" cellpadding="10" id="idPanelConditionPaiementBoncde" >
					
						<p:outputLabel value="Code paiement : " />
						<h:panelGrid columns="3" cellpadding="10" >
								<p:autoComplete value="#{bonCdeController.taCPaiementDoc}" converter="entityConverter" id="idCodeCPaiementBoncde"
								completeMethod="#{bonCdeController.typeCPaiementAutoComplete}" var="tp" itemLabel="#{tp.codeCPaiement}"
								itemValue="#{tp}" forceSelection="true" dropdown="true" disabled="#{bonCdeController.editable()}"
								placeholder="Condition de paiement" style="width:100%">
								<p:column>
									<h:outputText value="#{tp.codeCPaiement}" />
								</p:column>
								<p:column>
									<h:outputText value="#{tp.libCPaiement}" />
								</p:column>
								<f:attribute name="nomChamp" value="#{const.C_CODE_C_PAIEMENT}" />
								<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" 
								update="idLibelleCPaimentBoncde,idReportBoncde,idFinMoisBoncde,idDateEchBoncde,idMenuBoutonBoncde" />	
							</p:autoComplete>
						
						
<!-- 							<p:inputText value="#{bonCdeController.selectedCPaiement.codeCPaiement}" disabled="#{bonCdeController.editable()}"> -->
<!-- 								<p:ajax event="blur" update="@this" /> -->
<!-- 							</p:inputText> -->
							<p:commandButton value="Appliquer" styleClass="icon-refresh btn" disabled="#{bonCdeController.editable()}"
								actionListener="#{bonCdeController.actAppliquerCPaiement}" process="@this" update="idCodeCPaiementBoncde,idLibelleCPaimentBoncde,idReportBoncde,idFinMoisBoncde,idDateEchBoncde,idMenuBoutonBoncde" />						
						</h:panelGrid>

						<p:outputLabel value="Libellé : " />
						<p:inputText value="#{bonCdeController.selectedCPaiement.libCPaiement}" disabled="#{bonCdeController.editable()}" id="idLibelleCPaimentBoncde">
						<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Report : " />
						<p:inputText value="#{bonCdeController.selectedCPaiement.reportCPaiement}" disabled="#{bonCdeController.editable()}" id="idReportBoncde">
						<p:ajax event="blur" update="@this" />
						</p:inputText>
						<p:outputLabel value="Fin de mois : " />
						<p:inputText value="#{bonCdeController.selectedCPaiement.finMoisCPaiement}" disabled="#{bonCdeController.editable()}" id="idFinMoisBoncde">
						<p:ajax event="blur" update="@this" />
						</p:inputText>
					</h:panelGrid>
				</p:panel>

			</p:panel>

			<!-- 			</div> -->
			<!-- 		</div> -->
			
		</p:tab>

		<!-- 		<div class="ui-grid-row"> -->
		<!-- 			<div class="ui-grid-col-12"> -->

		<p:tab id="idLignesBoncde" title="Ligne">
		<p:panel widgetVar="wvLigneBoncdeMesssages">
			<p:messages id="idLigneBoncdeMessages" showDetail="true" closable="true" autoUpdate="false"/>
		</p:panel>
			<p:panel id="idPanelLignesBoncde" header="Lignes" toggleable="true" widgetVar="panelLignesBoncde">

<!-- 				<div class="text-center"> -->
<!--  					<p:commandButton value="Annuler" styleClass="btn-cancel btn"  -->
<!--  						actionListener="#{bonCdeController.actAnnulerLigne}"  -->
<!--  						process="@this"  -->
<!--  						update="@widgetVar(panelLignesBoncde),:form:messages,@form"  -->
<!-- 						disabled="#{bonCdeController.etatBoutonLigne('annuler')}" />  -->
						
<!--  					<p:commandButton value="Enregistrer" styleClass="btn-save btn"  -->
<!--  						actionListener="#{bonCdeController.actEnregistrerLigne}"  -->
<!--  						update="@widgetVar(panelLignesBoncde),:form:messages,@form"  -->
<!-- 						disabled="#{bonCdeController.etatBoutonLigne('enregistrer')}" />  -->

<!-- 					<p:commandButton value="Insérer" styleClass="btn-insert btn" -->
<!-- 						actionListener="#{bonCdeController.actInsererLigne}" -->
<!-- 						process="@this" -->
<!-- 						update="@this,@widgetVar(widgetVarDataTableLigneBoncde),:form:messages" -->
<!-- 						disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or bonCdeController.etatBoutonLigne('inserer')}" -->
<!-- 						oncomplete="jQuery('.myclassBoncde .ui-datatable-data tr').last().find('span.ui-icon-pencil').each(function(){jQuery(this).click()});" /> -->

<!--  					<p:commandButton value="Modifier" styleClass="btn-update btn"  -->
<!-- 						actionListener="#{bonCdeController.actModifierLigne}"  -->
<!--  						process="@this"  -->
<!--  						update="@widgetVar(panelLignesBoncde),:form:messages,@form"  -->
<!--  						disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or bonCdeController.etatBoutonLigne('modifier')}" />  -->

<!-- 					<p:commandButton value="Supprimer" styleClass="btn-delete btn" widgetVar="widgetVarBtnSupprimer" -->
<!-- 						actionListener="#{bonCdeController.actSupprimerLigne}" -->
<!-- 						process="@this" -->
<!-- 						update="@widgetVar(panelLignesBoncde),:form:messages,@form" -->
<!-- 						disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or bonCdeController.etatBoutonLigne('supprimer')}" /> -->
<!-- 				</div> -->
				
				<p:menubar styleClass="menu-onglet">
				
					<p:menuitem title="Insérer" styleClass="icon-insert icon"
						actionListener="#{bonCdeController.actInsererLigne}"
						process="@this"
						update="@this,@widgetVar(widgetVarDataTableLigneBoncde),:form:messages"
						disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or bonCdeController.etatBoutonLigne('inserer')}"
						oncomplete="editionDerniereLigne('myclassBoncde');" />
						
					<p:menuitem title="Supprimer" styleClass="icon-delete icon" widgetVar="widgetVarBtnSupprimer"
						actionListener="#{bonCdeController.actSupprimerLigne}"
						process="@this"
						update="@widgetVar(panelLignesBoncde),:form:messages,@widgetVar(#{bonCdeController.wvEcran})"
						disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or bonCdeController.etatBoutonLigne('supprimer')}" />
				</p:menubar>
				
				<p:dataTable id="iddataTableLigneBoncde" 
					var="ligne"
					widgetVar="widgetVarDataTableLigneBoncde"
					value="#{bonCdeController.valuesLigne}"
					rowKey="#{ligne.dto.numLigneLDocument}"
					selection="#{bonCdeController.selectedLigneJSF}"
					selectionMode="single" 
					editable="true" 
					dblClickSelect="true"
					styleClass="datatable mt10 myclassBoncde" 
					resizableColumns="true" 
					draggableRows="true">
        
<!-- 					paginator="true" -->
<!-- 					rows="#{msg.modele_datatable_ligne_par_page_debut}" -->
<!-- 					paginatorTemplate="#{msg.modele_datatable_paginator_sans_exporter}" -->
<!-- 					rowsPerPageTemplate="#{msg.modele_datatable_lignes_par_page}" -->
<!-- 					emptyMessage="#{msg.message_datatable_vide}" -->
<!-- 					currentPageReportTemplate="#{msg.modele_datatable_page_courante}"> -->
<!-- onsuccess="increment();"  -->

					<p:ajax event="rowReorder" listener="#{bonCdeController.onRowReorder}" update="@this,@widgetVar(wvMenuBoutonBoncde)" />
					<p:ajax event="rowEdit" listener="#{bonCdeController.onRowEdit}" update="@widgetVar(wvLigneBoncdeMesssages),@parent:idTotauxLBoncde" 
					oncomplete="if(!handleCompleteValidationError(xhr, status, args)) {increment();};autreLigneModifiable('myclassBoncde');" />
					<p:ajax event="rowEditCancel" listener="#{bonCdeController.onRowCancel}" update="@widgetVar(widgetVarBtnSupprimer)" oncomplete="autreLigneModifiable('myclassBoncde');"/>
					<p:ajax event="rowSelect" listener="#{bonCdeController.onRowSelectLigne}" />
					<p:ajax event="rowEditInit" listener="#{bonCdeController.onRowEditInit}"  update="@widgetVar(wvIduSaisieLBoncde),@widgetVar(wvIdQteSaisieLBoncde)"  
					oncomplete="autreLigneNonModifiable('myclassBoncde');"/>
					
					
					<p:ajax event="toggleSelect" process="@this" />
					<p:ajax event="rowToggle" process="@this" oncomplete="ligneSeperationExpend()" />					
					<p:column style="width:8px" styleClass="center" >
						<p:rowToggler  rendered="#{ligne.ligneLieeFils!=null or ligne.ligneLieeMere!=null or ligne.ligneAbonnement!=null}"/>
					</p:column>
					
					
					<p:column style="width:16px" >
						<p:rowEditor rendered="#{bonCdeController.etatBoutonLigne('rowEditor')}" styleClass="row-editor-debut"/>
					</p:column>
					
					<p:column style="width:8px">
						<f:facet name="header">
							<h:outputText value="N°" />
						</f:facet>
						<h:outputText value="#{ligne.dto.numLigneLDocument}" />
					</p:column>
					
					<p:column style="width:6%">
						<f:facet name="header">
							<h:outputText value="Code article" />
						</f:facet>
						<p:cellEditor  disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.taArticle.codeArticle}"/>
							</f:facet>
							<f:facet name="input">
							<p:focus>
								<p:autoComplete value="#{ligne.taArticleDTO}"
									completeMethod="#{bonCdeController.articleAutoCompleteDTOLight}"
									id="idarticleBoncde" converter="entityConverter"
									var="art" itemLabel="#{art.codeArticle}" itemValue="#{art}"
									forceSelection="true" dropdown="true" 
									maxResults="#{bonCdeController.taPreferencesService.nbMaxChargeListeArticle()}"
									moreText="Il y a #{component.maxResults} affichés sur #{component.suggestions.size()} au total, Veuillez affiner votre recherche ou cliquer ici pour en afficher plus ..."
									 placeholder="Article" 
									style="width:100%">
<!-- 									required="true" requiredMessage="Le code article est obligatoire" unlimited -->
									
									<p:column>
										<h:outputText value="#{art.codeArticle}" />
									</p:column>
									
									<p:column>
										<h:outputText value="#{art.libellecArticle}" />
									</p:column>
									<p:column >
										<h:outputText value="#{art.commentaireArticle}" rendered="#{bonCdeController.rechercheAvecCommentaire(false)}"/>
									</p:column>

									<f:attribute name="nomChamp" value="#{const.C_CODE_ARTICLE}" />
									<p:ajax event="clear" listener="#{bonCdeController.onClearArticle}" 
									update="@parent:idlibLBoncde,idQte1LBoncde,idu1LBoncde,idu2LBoncde,idpuLBoncde,idQteTransportBcde,idCodeTransportBcde,idhtLBoncde,idttcLBoncde,idtvaLBoncde,idLRemiseBoncde,idqte2LBoncde,iduSaisieLBoncde,idQteSaisieLBoncde"/>"/>
									<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" 
									update="@parent:idlibLBoncde,idQte1LBoncde,idu1LBoncde,idu2LBoncde,idpuLBoncde,idQteTransportBcde,idCodeTransportBcde,idhtLBoncde,idttcLBoncde,idtvaLBoncde,idLRemiseBoncde,idqte2LBoncde,iduSaisieLBoncde,idQteSaisieLBoncde"/>"/>
									
									<p:ajax event="moreText" listener="#{bonCdeController.onMoreTextArticle}" />
								</p:autoComplete>
							</p:focus>
							</f:facet>
						</p:cellEditor >
					</p:column >

					<p:column style="width:28%">
						<f:facet name="header">
							<h:outputText value="Libellé" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.libLDocument}" id="idListeSaisieLibelleBoncde"/>
								<p:tooltip id="toolTipListeSaisieLibelleBoncde" value="#{ligne.dto.libLDocument}" shared="true" for="idListeSaisieLibelleBoncde" showEffect="clip" position="top"/>
<!-- 								<h:outputText value="#{ligne.dto.libLDocument}" /> -->
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{ligne.dto.libLDocument}" id="idlibLBoncde"
								validator="#{bonCdeController.validateLignesDocument}">
								<f:attribute name="nomChamp" value="#{const.C_LIB_L_DOCUMENT}" />
								<p:ajax event="blur" />
								</p:inputText>
							</f:facet>
						</p:cellEditor>
					</p:column>


					<p:column  style="width:5%" styleClass="right" rendered="#{bonCdeController.selectedDocumentDTO.utiliseUniteSaisie}">
						<f:facet name="header">
							<h:outputText value="Qté Saisie" />
						</f:facet>
						<p:cellEditor >
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.qteSaisieLDocument}"/>	
							</f:facet>
							<f:facet name="input" >
								<p:inputText id="idQteSaisieLBoncde" widgetVar="wvIdQteSaisieLBoncde" value="#{ligne.dto.qteSaisieLDocument}"  style="width:100%" 
										validator="#{bonCdeController.validateLignesDocument}" disabled="#{ligne.ligneCommentaire() or !bonCdeController.enabledUniteSaisie()}">
									<f:attribute name="nomChamp" value="#{const.C_QTE_SAISIE_L_DOCUMENT}" /> 
									<p:ajax event="blur" update="@parent:idQte1LBoncde,idu1LBoncde,idQteTransportBcde,idqte2LBoncde,idu2LBoncde,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:inputText>
							</f:facet >
						</p:cellEditor>
					</p:column>


					<p:column style="width:5%"  styleClass="center" rendered="#{bonCdeController.selectedDocumentDTO.utiliseUniteSaisie}">
						<f:facet name="header">
							<h:outputText value="U. Saisie" />
						</f:facet>
						<p:cellEditor >
							<f:facet name="output">
								<h:outputText value="#{ligne.taUniteSaisie.codeUnite}" />
							</f:facet>
							<f:facet name="input">
<!-- 								<p:inputText value="#{ligne.taUnite1.codeUnite}" style="width:100%" id="u1"/> -->
								<p:autoComplete value="#{ligne.taUniteSaisie}"
									completeMethod="#{bonCdeController.uniteAutoCompleteLightUniteSaisie}"
									var="unit" itemLabel="#{unit.codeUnite}" itemValue="#{unit}"
									forceSelection="true" dropdown="true"
									placeholder="USaisie" style="width:100%" id="iduSaisieLBoncde" widgetVar="wvIduSaisieLBoncde" disabled="#{ligne.ligneCommentaire() or !bonCdeController.enabledUniteSaisie()}" >
									<p:column>
										<h:outputText value="#{unit.codeUnite}" />
									</p:column>
									
									<f:attribute name="nomChamp" value="#{const.C_U_SAISIE_L_DOCUMENT}" />
									<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" update="@parent:,idQteTransportBcde,idQteSaisieLBoncde,idQte1LBoncde,idu1LBoncde,idqte2LBoncde,idu2LBoncde,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:autoComplete>
							</f:facet>
						</p:cellEditor>
					</p:column>

					
					
					<p:column  style="width:4%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Qté 1" />
						</f:facet>
						<p:cellEditor >
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.qteLDocument}"/>	
							</f:facet>
							<f:facet name="input" >
								<p:inputText id="idQte1LBoncde"  value="#{ligne.dto.qteLDocument}"  style="width:100%" 
										validator="#{bonCdeController.validateLignesDocument}" disabled="#{ligne.ligneCommentaire()}">
									<f:attribute name="nomChamp" value="#{const.C_QTE_L_DOCUMENT}" /> 
									<p:ajax event="blur" update="@parent:idQteTransportBcde,idqte2LBoncde,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:inputText>
							</f:facet >
						</p:cellEditor>
					</p:column>

					<p:column style="width:5%"  styleClass="center">
						<f:facet name="header">
							<h:outputText value="Unité 1" />
						</f:facet>
<!-- 						<p:cellEditor > -->
<!-- 							<f:facet name="output"> -->
<!-- 								<h:outputText value="#{ligne.dto.u1LDocument}" /> -->
<!-- 							</f:facet> -->
<!-- 							<f:facet name="input"> -->
<!-- 								<p:inputText value="#{ligne.dto.u1LDocument}" style="width:100%" id="u1"/> -->
<!-- 							</f:facet> -->
<!-- 						</p:cellEditor> -->
						<p:cellEditor  disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.taUnite1.codeUnite}" />
							</f:facet>
							<f:facet name="input">
<!-- 								<p:inputText value="#{ligne.taUnite1.codeUnite}" style="width:100%" id="u1"/> -->
								<p:autoComplete value="#{ligne.taUnite1}"
									completeMethod="#{bonCdeController.uniteAutoComplete}"
									var="unit" itemLabel="#{unit.codeUnite}" itemValue="#{unit}"
									forceSelection="true" dropdown="true"
									placeholder="U1" style="width:100%" id="idu1LBoncde" disabled="#{ligne.ligneCommentaire()}">
									<p:column>
										<h:outputText value="#{unit.codeUnite}" />
									</p:column>
									
									<f:attribute name="nomChamp" value="#{const.C_U1_L_DOCUMENT}" />
									<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" update="@parent:idqte2LBoncde"/>
								</p:autoComplete>
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column  style="width:4%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Qté 2" />
						</f:facet>
							<p:cellEditor >
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.qte2LDocument}"/>	
							</f:facet>
							<f:facet name="input" >
								<p:inputText id="idqte2LBoncde"  value="#{ligne.dto.qte2LDocument}"  style="width:100%" 
										validator="#{bonCdeController.validateLignesDocument}" disabled="#{ligne.ligneCommentaire()}">
									<f:attribute name="nomChamp" value="#{const.C_QTE2_L_DOCUMENT}" /> 
									<p:ajax event="blur" update="@parent:idQte1LBoncde,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:inputText>
							</f:facet >
						</p:cellEditor>
					</p:column>

					<p:column style="width:5%" styleClass="center">
						<f:facet name="header">
							<h:outputText value="Unité 2" />
						</f:facet>
<!-- 						<h:outputText value="#{ligne.dto.u2LDocument}" id="u2" />					 -->
						<p:cellEditor  disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.taUnite2.codeUnite}"/>
							</f:facet>
							<f:facet name="input">
<!-- 								<p:inputText value="#{ligne.taUnite2.codeUnite}" style="width:100%" id="u2"/> -->
								<p:autoComplete value="#{ligne.taUnite2}"
									completeMethod="#{bonCdeController.uniteAutoCompleteAll}"
									var="unit" itemLabel="#{unit.codeUnite}" itemValue="#{unit}"
									forceSelection="true" dropdown="true"
									placeholder="U2" style="width:100%" id="idu2LBoncde" disabled="#{ligne.ligneCommentaire()}">
									<p:column>
										<h:outputText value="#{unit.codeUnite}" />
									</p:column>
									
									<f:attribute name="nomChamp" value="#{const.C_U2_L_DOCUMENT}" />
									<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" update="@parent:idqte2LBoncde"/>
								</p:autoComplete>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:8%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Prix unitaire" />
						</f:facet>
						<p:cellEditor disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.prixULDocument}" title="#{ligne.dto.prixULDocument}">
									<f:convertNumber type="currency"  minFractionDigits="#{bonCdeController.prefNbDecimalesPrix}" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{ligne.dto.prixULDocument}" id="idpuLBoncde" style="width:100%" 
										validator="#{bonCdeController.validateLignesDocument}" disabled="#{ligne.ligneCommentaire()}">
									<f:attribute name="nomChamp" value="#{const.C_PRIX_U_L_DOCUMENT}" /> 
									<p:ajax event="blur" update="@this,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:inputText>	
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:5%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Remise %" />
						</f:facet>
						<p:cellEditor disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.remTxLDocument}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{ligne.dto.remTxLDocument}" style="width:100%" id="idLRemiseBoncde"
										validator="#{bonCdeController.validateLignesDocument}" disabled="#{ligne.ligneCommentaire()}">
									<f:attribute name="nomChamp" value="#{const.C_REM_TX_L_DOCUMENT}" /> 
									<p:ajax event="blur" update="@this,idhtLBoncde,idttcLBoncde,idtvaLBoncde"/>
								</p:inputText>	
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:10%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Montant HT" />
						</f:facet>
						<p:cellEditor disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.mtHtLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<h:outputText value="#{ligne.dto.mtHtLDocument}" id="idhtLBoncde" style="width:100%" disabled="true"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:10%" styleClass="right">
						<f:facet name="header">
							<h:outputText value="Montant TTC" />
						</f:facet>
						<p:cellEditor disabled="#{ligne.ligneLieeFils!=null}">
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.mtTtcLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<h:outputText value="#{ligne.dto.mtTtcLDocument}" id="idttcLBoncde" style="width:100%"  disabled="true"/>
						
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:3%" styleClass="center">
						<f:facet name="header">
							<h:outputText value="TVA" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.codeTvaLDocument}" disabled="true">
									<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<h:outputText value="#{ligne.dto.codeTvaLDocument}" disabled="true" id="idtvaLBoncde" style="width:100%"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column style="width:7%" styleClass="right">
						<f:facet name="header">
					<h:outputText value="date prévue" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.datePrevue}" >
										<f:convertDateTime pattern="dd/MM/yyyy" timeZone="#{msg.time_zone}"  />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:calendar value="#{ligne.dto.datePrevue}" pattern="dd/MM/yyyy" mask="true" mode="popup"  timeZone="#{msg.time_zone}" 
									locale="fr" navigator="true" id="dluo"/>
							</f:facet>
						</p:cellEditor>
					</p:column>


					<p:column style="width:5%" styleClass="right"  rendered="#{bonCdeController.gestionCapsules}">
						<f:facet name="header">
							<h:outputText value="Qté CRD"  />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.qteTitreTransport}"  />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{ligne.dto.qteTitreTransport}"  id="idQteTransportBcde" style="width:100%" validator="#{bonCdeController.validateLignesDocument}"  disabled="#{ligne.ligneCommentaire()}">
									<f:attribute name="nomChamp" value="#{const.C_QTE_TITRE_TRANSPORT_L_DOCUMENT}" />
									<p:ajax event="blur" update="@this"/>
								</p:inputText>
							</f:facet>
						</p:cellEditor>						
					</p:column>


					<p:column  style="width:5%" styleClass="right"  rendered="#{bonCdeController.gestionCapsules}">
						<f:facet name="header">
							<h:outputText value="Titre CRD" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{ligne.dto.codeTitreTransport}">
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:autoComplete value="#{ligne.taTitreTransport}" id="idCodeTransportBcde"
								completeMethod="#{bonCdeController.titreTransportAutoComplete}" var="unit" itemLabel="#{unit.codeTitreTransport}"
									itemValue="#{unit}" forceSelection="true" dropdown="true" placeholder="U2" style="width:100%" converter="entityConverter"  disabled="#{ligne.ligneCommentaire()}">
									<p:column>
										<h:outputText value="#{unit.codeTitreTransport}" />
									</p:column>

									<f:attribute name="nomChamp" value="#{const.C_CODE_TITRE_TRANSPORT}" />
									 <p:ajax event="clear" listener="#{bonCdeController.onClearTaTitreTransport}" update="idQteTransportBcde"/>
									<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}"/>
								</p:autoComplete>
							</f:facet>
						</p:cellEditor>
					</p:column>
					


					
					
					

					<p:column style="width:1%">
						<f:facet name="header">
							<h:outputText value="Etat" />
						</f:facet>
								<h:outputText value="#{ligne.codeEtat}"  id="idListeSaisieEtat#{variableEcran}"/>
								<p:tooltip  value="#{ligne.codeEtat.concat(ligne.libelleEtat)}" shared="true" for="idListeSaisieEtat#{variableEcran}" showEffect="clip" position="top"/>
					</p:column>	
					
					<p:column style="width:16px">
						<f:facet name="header">
							<h:outputText value="" />
						</f:facet>
						<p:cellEditor>
							<f:facet name="output">
								<p:commandButton title="Supprimer" styleClass="icon-delete icon icon-grille" widgetVar="widgetVarBtnSupprimer"
									action="#{bonCdeController.actSupprimerLigne}"
									process="@this"
									disabled="#{!bonCdeController.modeEcran.dataSetEnModif() or ligne.ligneLieeFils!=null  or bonCdeController.etatBoutonLigne('supprimer')}"
									update="@widgetVar(panelLignesBoncde)">
<!-- 									<f:attribute name="idLigne" value="#{ligne.dto.id}" /> -->
									<f:setPropertyActionListener target="#{bonCdeController.selectedLigneJSF}" value="#{ligne}" />
								</p:commandButton>
							</f:facet>
							<f:facet name="input">
								<h:outputText value="" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column style="width:26px">
						<p:rowEditor rendered="#{bonCdeController.etatBoutonLigne('rowEditor')}" styleClass="row-editor-fin"/>
					</p:column>

					<p:rowExpansion>
					<p:panelGrid columns="2"  columnClasses="ui-grid-col-6,ui-grid-col-6" styleClass="ui-panelgrid-blank" layout="grid" rendered="#{ligne.ligneLieeFils!=null or ligne.ligneLieeMere!=null}">
					<p:panel header="document ayant servi à générer le document courant" style="width:100%;" >
						<p:dataTable value="#{ligne.ligneLieeMere}" id="dataTableLigneLieeMere" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneLieeMere" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailDocument(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>
								<!-- 								<h:outputText value="#{lien.codeDocumentDest}" /> -->
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="lot" />
								</f:facet>
								<h:outputText value="#{lien.numLot}" />
							</p:column>
							<p:column styleClass="right">
								<f:facet name="header">
									<h:outputText value="Qté. reçue" />
								</f:facet>
								<h:outputText value="#{lien.qteRecue}" />
							</p:column>
<!-- 							<p:column> -->
<!-- 								<f:facet name="header"> -->
<!-- 									<h:outputText value="Etat" /> -->
<!-- 								</f:facet> -->
<!-- 								<h:outputText value="#{lien.etat}" /> -->
<!-- 							</p:column>							 -->

						</p:dataTable>
						</p:panel>
						<p:panel header="document généré à partir du document courant" style="width:100%;" >
						<p:dataTable value="#{ligne.ligneLieeFils}" id="dataTableLigneLieeFils" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneLieeFils" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailDocument(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>
								<!-- 								<h:outputText value="#{lien.codeDocumentDest}" /> -->
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="lot" />
								</f:facet>
								<h:outputText value="#{lien.numLot}" />
							</p:column>
							<p:column styleClass="right">
								<f:facet name="header">
									<h:outputText value="Qté. reçue" />
								</f:facet>
								<h:outputText value="#{lien.qteRecue}" />
							</p:column>
<!-- 							<p:column> -->
<!-- 								<f:facet name="header"> -->
<!-- 									<h:outputText value="Etat" /> -->
<!-- 								</f:facet> -->
<!-- 								<h:outputText value="#{lien.etat}" /> -->
<!-- 							</p:column>							 -->

						</p:dataTable>
						</p:panel>
					</p:panelGrid>
					<p:panel header="Infos de l'abonnement" style="width:100%;" rendered="#{ligne.ligneAbonnement!=null}">

						<p:dataTable value="#{ligne.ligneAbonnement}" id="dataTableLigneAbonnement" var="lien" selectionMode="single" editable="true"
							selection="#{bonCdeController.selectedLigneALigneDTO}" rowKey="#{lien.id}" widgetVar="wvdataTableLigneAbonnement" 
							emptyMessage="#{msg.message_datatable_vide}" resizableColumns="true">
								<p:column  style="width:80px" >
									<p:commandButton value="" actionListener="#{bonCdeController.actDialogDetailLigneAbonnement}" process="@this"
										styleClass="icon-medium icon-reglement" title="Détail de la ligne d'abonnement">
										<f:attribute name="taLigneALigneEcheanceDTO" value="#{lien}" />
										<p:ajax event="dialogReturn" listener="#{bonCdeController.handleReturnDialogDetailLigneAbonnement}" />
									</p:commandButton>
								</p:column>

							<p:column>
								<f:facet name="header">
									<h:outputText value="code document" />
								</f:facet>
								<p:commandLink value="#{lien.codeDocumentDest}"
									action="#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.detailAbonnement(bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.recupCodeDocument(lien.codeDocumentDest,lien.typeDocument))}"
									update=":form:tabView"
									oncomplete="activeTabCenter('#{bonCdeController.duplicationDocumentBean.ouvertureDocumentBean.event.cssLgrTab}');">>
								</p:commandLink>

							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="libellé ligne" />
								</f:facet>
								<h:outputText value="#{lien.libelleLigne}" />
							</p:column>
						</p:dataTable>
</p:panel>

					</p:rowExpansion>
				

				</p:dataTable>
				
				<p:panelGrid columns="3" styleClass="totaux-lignes-document" id="idTotauxLBoncde">
					<f:facet name="header">
							<h:outputText value="Totaux" />
					</f:facet>
					
					<h:outputText value="NET HT" />
				
					<h:outputText value="NET TVA" />
			
					<h:outputText value="NET TTC" />
					<h:outputText value="#{bonCdeController.selectedDocumentDTO.netHtCalc}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
					</h:outputText>
					<h:outputText value="#{bonCdeController.selectedDocumentDTO.netTvaCalc}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
					</h:outputText>
					<h:outputText value="#{bonCdeController.selectedDocumentDTO.netTtcCalc}">
						<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
					</h:outputText>
					
				</p:panelGrid>
				


			</p:panel>
		</p:tab>
		
		<p:tab id="idTotauxFormBoncde" title="Totaux">

			<p:panel id="idPaneltotauxFormBoncde" header="Totaux" toggleable="true" widgetVar="panelTotauxFormBoncde">
				
				<div class="ui-grid ui-grid-responsive">
			<div class="ui-grid-row">
				<div class="ui-grid-col-6">
				<h:panelGrid columns="2" cellpadding="10">
						<p:outputLabel value="Remise globale %" />
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.txRemHtDocument}" disabled="#{bonCdeController.editable()}"
							validator="#{bonCdeController.validateDocument}">
							<f:attribute name="nomChamp" value="#{const.C_TX_REM_HT_DOCUMENT}" />
							<p:ajax event="blur" update="@this,@widgetVar(panelTotauxFormBoncde)"/>
						</p:inputText>
						
						<p:outputLabel value="Montant HT" />
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.netHtCalc}" disabled="true">
							<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:inputText>
						
						<p:outputLabel value="Montant TVA" />
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.netTvaCalc}" disabled="true">
							<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:inputText>
						
						<p:outputLabel value="Escompte accordé %"  rendered="false"/>
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.txRemTtcDocument}" disabled="#{bonCdeController.editable()} " rendered="false"
							validator="#{bonCdeController.validateDocument}">
							<f:attribute name="nomChamp" value="#{const.C_TX_REM_TTC_DOCUMENT}" />
							<p:ajax event="blur" update="@this,@widgetVar(panelTotauxFormBoncde)"/>
						</p:inputText>
						
						<p:outputLabel value="Montant TTC" />
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.netTtcCalc}" disabled="true">
							<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</p:inputText>
						
						<p:outputLabel value="Accompte" rendered="false"/>
						<p:inputText value="#{bonCdeController.selectedDocumentDTO.compte}" disabled="true" rendered="false"/>
						
						<p:outputLabel value="Imprimer" />
						<p:selectBooleanCheckbox value="#{bonCdeController.impressionDirect}"  disabled="#{bonCdeController.editable()}">
							<p:ajax event="change" update="@this" />
						</p:selectBooleanCheckbox>
						
						<p:outputLabel value="Type paiement" rendered="false"/>
<!-- 						<p:inputText value="#{bonCdeController.selectedDocumentDTO.compte}"/> -->
						<p:autoComplete value="#{bonCdeController.taTPaiement}" rendered="false"
						converter="entityConverter"
							completeMethod="#{bonCdeController.typePaiementAutoComplete}"
							var="tp" itemLabel="#{tp.codeTPaiement}" itemValue="#{tp}"
							forceSelection="true" dropdown="true" disabled="#{bonCdeController.editable()}"
							placeholder="Type de paiement" style="width:100%" id="idtypePaiementBoncde">
							<p:column>
								<h:outputText value="#{tp.codeTPaiement}" />
							</p:column>
							<p:column>
								<h:outputText value="#{tp.libTPaiement}" />
							</p:column>
							<f:attribute name="nomChamp" value="#{const.C_CODE_T_PAIEMENT}" />
							<p:ajax event="itemSelect" listener="#{bonCdeController.autcompleteSelection}" />
						</p:autoComplete>
						
					</h:panelGrid>
				</div>
				
				<div class="ui-grid-col-6">
				<p:dataTable value="#{bonCdeController.masterEntity.lignesTVA}" var="ltva">
					<f:facet name="header">
							<h:outputText value="TVA" />
					</f:facet>
					<p:column>
						<f:facet name="header">
							<h:outputText value="Code TVA" />
						</f:facet>
						<h:outputText value="#{ltva.codeTva}" />
					</p:column>
					
					<p:column>
						<f:facet name="header">
							<h:outputText value="Libellé" />
						</f:facet>
						<h:outputText value="#{ltva.libelle}" />
					</p:column>
					
					<p:column>
						<f:facet name="header">
							<h:outputText value="Taux" />
						</f:facet>
						<h:outputText value="#{ltva.tauxTva}">
<!-- 							<f:convertNumber type="percentage" /> -->
						</h:outputText>
					</p:column>
					
					<p:column styleClass="right" >
						<f:facet name="header">
							<h:outputText value="Montant" />
						</f:facet>
						<h:outputText value="#{ltva.mtTva}">	
							<f:convertNumber type="currency" currencySymbol="#{msg.currency_code}" />
						</h:outputText>
					</p:column>
				</p:dataTable>
				
				</div>
				</div>
				</div>
			</p:panel>
			<p:panel>
		<div class="ui-grid-row">
			<div class="ui-grid-col-12">			
				<p:panel id="idPanelCommentaireBoncde" header="Commentaire" toggleable="true" widgetVar="panelCommentaire">				
						<p:inputTextarea value="#{bonCdeController.selectedDocumentDTO.commentaire}"  disabled="#{bonCdeController.editable()}" style="width:100%">
							<f:attribute name="nomChamp" value="#{const.C_LIBL_COMMENTAIRE}" />
							<p:ajax event="blur" update="@this"/>
						</p:inputTextarea>	
				</p:panel>
				
			</div>
		</div>
</p:panel>
		</p:tab>
		
<!-- 		<p:tab id="idValidationFormBoncde" title="Validation"> -->

<!-- 			<p:panel id="idPanelValidationForm" header="Validation" toggleable="true" widgetVar="panelValidationForm"> -->
			
<!-- 				<h:panelGrid columns="2" cellpadding="10"> -->

<!-- 					<p:outputLabel value="Code tiers : " /> -->
<!-- 					<h:outputText value="#{bonCdeController.taTiers}"/> -->
						

<!-- 					<p:outputLabel value="Code boncde : " /> -->
<!-- 					<h:outputText value="#{bonCdeController.selectedDocumentDTO.codeDocument}"/> -->
						

<!-- 					<p:outputLabel value="Date : " /> -->
<!-- 					<h:outputText value="#{bonCdeController.selectedDocumentDTO.dateDocument}"> -->
<!-- 							<f:convertDateTime pattern="dd/MM/yyyy" /> -->
<!-- 						</h:outputText> -->
					

<!-- 					<p:outputLabel value="Libellé : " /> -->
<!-- 					<h:outputText -->
<!-- 						value="#{bonCdeController.selectedDocumentDTO.libelleDocument}"/> -->
						

<!-- 					<p:outputLabel value="Observation : " /> -->
<!-- 					<h:outputText -->
<!-- 						value="#{bonCdeController.selectedDocumentDTO.commentaire}" /> -->

<!-- 				</h:panelGrid> -->
			
<!-- 				<p:dataTable id="dataTableValidationLigneBoncde"  -->
<!-- 					var="ligne" -->
<!-- 					widgetVar="widgetVarDataTableValidationLigneBoncde" -->
<!-- 					value="#{bonCdeController.valuesLigne}" -->
<!-- 					styleClass="datatable mt10" resizableColumns="true" -->
<!-- 					paginator="true" -->
<!-- 					rows="#{msg.modele_datatable_ligne_par_page_debut}" -->
<!-- 					paginatorTemplate="#{msg.modele_datatable_paginator_sans_exporter}" -->
<!-- 					rowsPerPageTemplate="#{msg.modele_datatable_lignes_par_page}" -->
<!-- 					emptyMessage="#{msg.message_datatable_vide}" -->
<!-- 					currentPageReportTemplate="#{msg.modele_datatable_page_courante}"> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Code article" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.taArticle.codeArticle}" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Libellé" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.taArticle.libellelArticle}" id="aa" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Entrepot" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.taEntrepot.codeEntrepot}" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Emplacement" /> -->
<!-- 						</f:facet> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="DLUO" /> -->
<!-- 						</f:facet> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Qté1" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.dto.qteLDocument}" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Unité 1" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.dto.u1LDocument}" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Qté2" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.dto.qte2LDocument}" /> -->
<!-- 					</p:column> -->

<!-- 					<p:column> -->
<!-- 						<f:facet name="header"> -->
<!-- 							<h:outputText value="Unité 2" /> -->
<!-- 						</f:facet> -->
<!-- 						<h:outputText value="#{ligne.dto.u2LDocument}" /> -->
<!-- 					</p:column> -->

<!-- 				</p:dataTable> -->
				
<!-- 			</p:panel> -->

<!-- 		</p:tab> -->
		
	</p:wizard>

	<!-- 			</div> -->
	<!-- 		</div> -->
	<!-- 	</div> -->

	<p:remoteCommand name="increment" binding="#{bonCdeController.rc}"
		actionListener="#{bonCdeController.actAutoInsererLigne}"
		process="@this" update="@widgetVar(panelLignesBoncde)"
		disabled="#{bonCdeController.insertAuto}"
		 />
<!-- oncomplete="jQuery('.myclassBoncde .ui-datatable-data tr').last().find('span.ui-icon-pencil').each(function(){jQuery(this).click()});" -->
	
	<!-- </f:validateBean> -->

	<p:dialog header="Cohérence de la qté 2" widgetVar="wVdialogQte2BonCde" modal="true" appendTo="@(body)" showEffect="clip" hideEffect="clip" width="900"
		height="200">
		<p:panelGrid columns="1">
			<p:outputLabel value="La qté 2 n'est pas cohérente par rapport au coefficient applicable, voulez vous la conserver ?" />
		</p:panelGrid>
		<p:panelGrid columns="2">
			<p:commandButton value="Conserver la valeur" process="@this" onstart="PF('wVdialogQte2BonCde').hide()" />
			<p:commandButton value="Appliquer le coefficient" process="@this" actionListener="#{bonCdeController.actArreterEnregistrementEtFocusQte2()}"
				oncomplete="PF('wVdialogQte2BonCde').hide()" update="@widgetVar(widgetVarDataTableLigneBoncde)" />
		</p:panelGrid>
	</p:dialog>


</ui:composition>