/******************************************************************************/
/*                 Generated by IBExpert 23/03/2009 10:57:30                  */
/******************************************************************************/



/******************************************************************************/
/*                                   Tables                                   */
/******************************************************************************/


CREATE GENERATOR NUM_ID_T_WEB;

CREATE TABLE TA_T_WEB (
    ID_T_WEB           DID3 NOT NULL /* DID3 = INTEGER NOT NULL */,
    CODE_T_WEB         DLGR_CODE /* DLGR_CODE = VARCHAR(20) NOT NULL */,
    LIBL_T_WEB         DLGR_LIB /* DLGR_LIB = VARCHAR(100) NOT NULL */,
    QUI_CREE_T_WEB     DLIB50 /* DLIB50 = VARCHAR(50) */,
    QUAND_CREE_T_WEB   TIMESTAMP DEFAULT 'NOW',
    QUI_MODIF_T_WEB    DLIB50 /* DLIB50 = VARCHAR(50) */,
    QUAND_MODIF_T_WEB  TIMESTAMP DEFAULT 'NOW',
    "VERSION"          NUM_VERSION /* NUM_VERSION = VARCHAR(20) */,
    IP_ACCES           DLIB50NN DEFAULT 0 /* DLIB50NN = VARCHAR(50) NOT NULL */,
    VERSION_OBJ        INTEGER
);




/******************************************************************************/
/*                                Primary Keys                                */
/******************************************************************************/

ALTER TABLE TA_T_WEB ADD PRIMARY KEY (ID_T_WEB);


/******************************************************************************/
/*                                  Triggers                                  */
/******************************************************************************/


SET TERM ^ ;



/******************************************************************************/
/*                            Triggers for tables                             */
/******************************************************************************/

CREATE exception E_XAKCODE_T_WEB 'Le type de site web doit être unique'
^

/* Trigger: TBI_TA_T_WEB */
CREATE OR ALTER TRIGGER TBI_TA_T_WEB FOR TA_T_WEB
ACTIVE BEFORE INSERT POSITION 0
as
begin
   If (New.ID_T_WEB is null) Then
      New.ID_T_WEB = GEN_ID(NUM_ID_T_WEB,1);
   New.CODE_T_WEB = Upper(New.CODE_T_WEB);
   New.QUI_CREE_T_WEB = USER;
   new.QUAND_CREE_T_WEB = 'NOW';
   new.QUI_MODIF_T_WEB = USER;
   new.QUAND_MODIF_T_WEB = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


/* Trigger: TBI_XAKCODE_T_WEB */
CREATE OR ALTER TRIGGER TBI_XAKCODE_T_WEB FOR TA_T_WEB
ACTIVE BEFORE INSERT POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKCODE_T_WEB  */
   select count(*) from TA_T_WEB
   where CODE_T_WEB = NEW.CODE_T_WEB
   into :numrows;
   if (numrows > 0) then
      exception E_XAKCODE_T_WEB ;
end
^


/* Trigger: TBU_TA_T_WEB */
CREATE OR ALTER TRIGGER TBU_TA_T_WEB FOR TA_T_WEB
ACTIVE BEFORE UPDATE POSITION 0
as
begin
   New.CODE_T_WEB = Upper(New.CODE_T_WEB);
   new.QUI_MODIF_T_WEB = USER;
   new.QUAND_MODIF_T_WEB = 'NOW';
   new.IP_ACCES = current_connection;
   select num_version from ta_version into new."VERSION";
end
^


/* Trigger: TBU_XAKCODE_T_WEB */
CREATE OR ALTER TRIGGER TBU_XAKCODE_T_WEB FOR TA_T_WEB
ACTIVE BEFORE UPDATE POSITION 1
as
DECLARE variable numrows integer;
begin
  /* E_XAKCODE_T_WEB  */
   If  ((OLD.ID_T_WEB <> NEW.ID_T_WEB)) then
   begin
     select count(*) from TA_T_WEB
     where CODE_T_WEB = NEW.CODE_T_WEB
     into :numrows;
     if (numrows > 0) then
        exception E_XAKCODE_T_WEB ;
   end
end
^


SET TERM ; ^



/******************************************************************************/
/*                                 Privileges                                 */
/******************************************************************************/


/* Privileges of users */
GRANT ALL ON TA_T_WEB TO "ADMIN" WITH GRANT OPTION;
