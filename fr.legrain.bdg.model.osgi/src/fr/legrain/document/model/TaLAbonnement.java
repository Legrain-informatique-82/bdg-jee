package fr.legrain.document.model;

// Generated Apr 9, 2009 2:12:06 PM by Hibernate Tools 3.2.0.CR1

import java.beans.PropertyChangeEvent;
import java.math.BigDecimal;
import java.math.MathContext;
import java.util.Date;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityListeners;
import javax.persistence.FetchType;
import javax.persistence.JoinColumn;
import javax.persistence.ManyToOne;
import javax.persistence.OneToMany;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;
import javax.persistence.Transient;
import javax.xml.bind.annotation.XmlTransient;

import org.apache.log4j.Logger;
import org.hibernate.annotations.Fetch;
import org.hibernate.annotations.FetchMode;

import fr.legrain.abonnement.stripe.model.TaStripePlan;
//import fr.legrain.abonnement.stripe.model.TaStripeSubscription;
//import fr.legrain.abonnement.stripe.model.TaStripeSubscriptionItem;
import fr.legrain.article.model.TaArticle;
import fr.legrain.article.model.TaEntrepot;
import fr.legrain.article.model.TaLot;
import fr.legrain.article.model.TaPrix;
import fr.legrain.document.dto.IDocumentTiers;
import fr.legrain.document.dto.ILigneDocumentTiers;
import fr.legrain.document.dto.TaLigneALigneSupplementDTO;
import fr.legrain.lib.data.LibCalcul;
import fr.legrain.validator.LgrHibernateValidated;

/**
 * TaLAbonnement generated by hbm2java
 */
@Entity
@EntityListeners(SwtLDocumentListener.class)
//@Cache(usage=CacheConcurrencyStrategy.READ_WRITE)
@Table(name = "ta_l_abonnement")
//@SequenceGenerator(name = "gen_l_abonnement", sequenceName = "num_id_l_abonnement", allocationSize = 1)
public class TaLAbonnement extends SWTLigneDocument implements java.io.Serializable, ILigneDocumentTiers {

	private static final long serialVersionUID = 8432033474240379051L;
	
	//	private int idLDocument;
	private String version;
	private TaTLigne taTLigne;
	private TaArticle taArticle;
	private TaAbonnement taDocument;
	private Integer numLigneLDocument;
//	private String libLDocument;
	private BigDecimal qteLDocument;
	private BigDecimal qte2LDocument;
	private String u1LDocument;
	private String u2LDocument;
	private BigDecimal prixULDocument;
	private BigDecimal tauxTvaLDocument;
	private String compteLDocument;
	private String codeTvaLDocument;
	private String libTvaLDocument;
	private String codeTTvaLDocument;
	private BigDecimal mtHtLDocument;
	private BigDecimal mtTtcLDocument;
	private BigDecimal remTxLDocument;
	private BigDecimal remHtLDocument;
	//private TaStripeSubscriptionItem taStripeSubscriptionItem;
	private String quiCree;
	private Date quandCree;
	private String quiModif;
	private Date quandModif;
	
	private BigDecimal commissionBancaire;
	private BigDecimal commissionPanier;
	private String nomDossier;

	private String ipAcces;
	@Transient
	private boolean legrain = false;
	@Transient
	private BigDecimal txRemHtDocument;
	@Transient
	static Logger logger = Logger.getLogger(TaLAbonnement.class.getName());
	@Transient
	private BigDecimal mtHtLApresRemiseGlobaleDocument;
	@Transient
	private BigDecimal mtTtcLApresRemiseGlobaleDocument;
	
	//champs venant de taStripeSubscriptionitem
	private String idExterne;
	private TaStripePlan taPlan;
	private String complement1;
	private String complement2;
	private String complement3;
	
	//rajout yann pour etat
	private Set<TaLigneALigne> taLigneALignes = new HashSet<TaLigneALigne>(0);
	private Set<TaREtatLigneDocument> taREtatLigneDocuments = new HashSet<TaREtatLigneDocument>(0);
	private Set<TaHistREtatLigneDocument> taHistREtatLigneDocuments = new HashSet<TaHistREtatLigneDocument>(0);
	
	//protected TaREtatLigneDocument taREtat;
	
	private String uSaisieLDocument;
	private BigDecimal qteSaisieLDocument;
	
	private String codeTitreTransport;
	private BigDecimal qteTitreTransport;



	private BigDecimal coefMultiplicateur;
	
	
	private Date dateDebutAbonnement;

	
	public TaLAbonnement() {
	}
	
	public TaLAbonnement	(boolean legrain) {
		this.legrain = legrain;
	}
	
	public TaLAbonnement(int idLAbonnement) {
		this.idLDocument = idLAbonnement;
	}

	public TaLAbonnement(int idLAbonnement, TaTLigne taTLigne, TaArticle taArticle,
			TaAbonnement taAbonnement, Integer numLigneLAbonnement, String libLAbonnement,
			BigDecimal qteLAbonnement, BigDecimal qte2LAbonnement, String u1LAbonnement,
			String u2LAbonnement, BigDecimal prixULAbonnement, BigDecimal tauxTvaLAbonnement,
			String compteLAbonnement, String codeTvaLAbonnement, String codeTTvaLAbonnement,
			BigDecimal mtHtLAbonnement, BigDecimal mtTtcLAbonnement,
			BigDecimal remTxLAbonnement, BigDecimal remHtLAbonnement,
			String quiCreeLAbonnement, Date quandCreeLAbonnement, String quiModifLAbonnement,
			Date quandModifLAbonnement, String ipAcces, Integer versionObj) {
		this.idLDocument = idLAbonnement;
		this.taTLigne = taTLigne;
		this.taArticle = taArticle;
		this.taDocument = taAbonnement;
		this.numLigneLDocument = numLigneLAbonnement;
		this.libLDocument = libLAbonnement;
		this.qteLDocument = qteLAbonnement;
		this.qte2LDocument = qte2LAbonnement;
		this.u1LDocument = u1LAbonnement;
		this.u2LDocument = u2LAbonnement;
		this.prixULDocument = prixULAbonnement;
		this.tauxTvaLDocument = tauxTvaLAbonnement;
		this.compteLDocument = compteLAbonnement;
		this.codeTvaLDocument = codeTvaLAbonnement;
		this.codeTTvaLDocument = codeTTvaLAbonnement;
		this.mtHtLDocument = mtHtLAbonnement;
		this.mtTtcLDocument = mtTtcLAbonnement;
		this.remTxLDocument = remTxLAbonnement;
		this.remHtLDocument = remHtLAbonnement;
		this.quiCree = quiCreeLAbonnement;
		this.quandCree = quandCreeLAbonnement;
		this.quiModif = quiModifLAbonnement;
		this.quandModif = quandModifLAbonnement;
		this.ipAcces = ipAcces;
		this.versionObj = versionObj;
	}

//	@Id
//	@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "gen_l_abonnement")
//	@Column(name = "id_l_document", unique = true, nullable = false)
//	public int getIdLDocument() {
//		return this.idLDocument;
//	}
//
//	public void setIdLDocument(int idLAbonnement) {
//		this.idLDocument = idLAbonnement;
//	}

	@Column(name = "version", length = 20)
	public String getVersion() {
		return this.version;
	}

	public void setVersion(String version) {
		this.version = version;
	}

	@ManyToOne(fetch = FetchType.EAGER)
	@JoinColumn(name = "id_t_ligne")
	@LgrHibernateValidated(champBd = "id_t_ligne",table = "ta_t_ligne", champEntite="taTLigne.idTLigne", clazz = TaTLigne.class)
	public TaTLigne getTaTLigne() {
		return this.taTLigne;
	}

	public void setTaTLigne(TaTLigne taTLigne) {
		this.taTLigne = taTLigne;
	}

	@ManyToOne(fetch = FetchType.EAGER, cascade = CascadeType.REFRESH)
	@JoinColumn(name = "id_article")
	@LgrHibernateValidated(champBd = "id_article",table = "ta_article", champEntite="taArticle.idArticle", clazz = TaArticle.class)
	public TaArticle getTaArticle() {
		return this.taArticle;
	}

//	public void setTaArticle(TaArticle taArticle) {
//		this.taArticle = taArticle;
//		if(legrain) {
//			if(taArticle!=null) {
//				if(getTaTLigne()==null || getTaTLigne().getCodeTLigne()==null)
//					setTaTLigne(new TaTLigneDAO().findByCode(Const.C_CODE_T_LIGNE_H));
//				else
//					if(!getTaTLigne().getCodeTLigne().equals(Const.C_CODE_T_LIGNE_H))
//						setTaTLigne(new TaTLigneDAO().findByCode(Const.C_CODE_T_LIGNE_H));
//
//				TaPrix prix = taArticle.chercheTarif(taDocument.getTaTiers());
//				if(prix!=null) {
//					if(taDocument!=null) { //#JPA
//						if(taDocument.getTtc()==1)
//							setPrixULDocument(prix.getPrixttcPrix());
//						else
//							setPrixULDocument(prix.getPrixPrix());
//					}
//
//					if(taArticle.getTaUnite1()!=null) {
//						setU1LDocument(taArticle.getTaUnite1().getCodeUnite());
//					}
//				}
//
//				if(taArticle.getTaTva()!=null && taDocument.isGestionTVA()) {
//					setCodeTvaLDocument(taArticle.getTaTva().getCodeTva());
//					setTauxTvaLDocument(taArticle.getTaTva().getTauxTva());
//				}
//
//				setLibLDocument(taArticle.getLibellecArticle());
//				setQteLDocument(new BigDecimal(1));
//				setCompteLDocument(taArticle.getNumcptArticle());
//
//				calculMontant();
//			}
//			
//			
//		}
//	}
	public void setTaArticle(TaArticle taArticle) {
		this.taArticle = taArticle;

		if(legrain) {
			if(taArticle!=null) {
				
				System.out.println("===****=== Transfert de code metier des entites vers les services, à bien vérifier");
				//passage ejb => dans TaAbonnementService
//				if(getTaTLigne()==null || getTaTLigne().getCodeTLigne()==null)
//					setTaTLigne(new TaTLigneDAO().findByCode(SWTDocument.C_CODE_T_LIGNE_H));
//				else
//					if(!getTaTLigne().getCodeTLigne().equals(SWTDocument.C_CODE_T_LIGNE_H))
//						setTaTLigne(new TaTLigneDAO().findByCode(SWTDocument.C_CODE_T_LIGNE_H));
				
				boolean commentaire=false;
				commentaire=taArticle.getTaFamille()!=null && taArticle.getTaFamille().getCodeFamille().equals("&&&");
				if(!commentaire){
					TaPrix prix = taArticle.chercheTarif(taDocument.getTaTiers());
					if(prix!=null) {
						if(taDocument!=null) { //#JPA
							if(taDocument.getTtc()==1)
								setPrixULDocument(prix.getPrixttcPrix());
							else
								setPrixULDocument(prix.getPrixPrix());
						}

						if(taArticle.getTaUnite1()!=null) {
							setU1LDocument(taArticle.getTaUnite1().getCodeUnite());
						}
					}else{
						setPrixULDocument(BigDecimal.valueOf(0));
						setU1LDocument("");
					}

					if(taArticle.getTaTva()!=null && taDocument.isGestionTVA()) {
						setCodeTvaLDocument(taArticle.getTaTva().getCodeTva());
						setLibTvaLDocument(taArticle.getTaTva().getLibelleTva());
						setTauxTvaLDocument(taArticle.getTaTva().getTauxTva());
					}else{
						setCodeTvaLDocument("");
						setLibTvaLDocument(null);
						setTauxTvaLDocument(BigDecimal.valueOf(0));
					}
					setQteLDocument(new BigDecimal(1));
					setCompteLDocument(taArticle.getNumcptArticle());
					calculMontant();
					setLibLDocument(taArticle.getLibellecArticle());
				}
				else {
				setLibLDocument(taArticle.getLibellecArticle());
				setTaArticle(null);
				}
			}
		}
	}

	@ManyToOne(fetch = FetchType.EAGER)
	@JoinColumn(name = "id_document")
	@LgrHibernateValidated(champBd = "id_document",table = "ta_abonnement", champEntite="taDocument.idDocument", clazz = TaAbonnement.class)
	public TaAbonnement getTaDocument() {
		return this.taDocument;
	}

	public void setTaDocument(TaAbonnement taAbonnement) {
		this.taDocument = taAbonnement;
	}
	
	public void setTaDocumentGeneral(IDocumentTiers taDocument) {
		this.taDocument = (TaAbonnement) taDocument;
	}

	@Column(name = "num_ligne_l_document")
	@LgrHibernateValidated(champBd = "num_ligne_l_document",table = "ta_l_abonnement", champEntite="numLigneLDocument", clazz = TaLAbonnement.class)
	public Integer getNumLigneLDocument() {
		return this.numLigneLDocument;
	}

	public void setNumLigneLDocument(Integer numLigneLAbonnement) {
		this.numLigneLDocument = numLigneLAbonnement;
	}

	@Column(name = "lib_l_document")
	@LgrHibernateValidated(champBd = "lib_l_document",table = "ta_l_abonnement", champEntite="libLDocument", clazz = TaLAbonnement.class)
	public String getLibLDocument() {
		return this.libLDocument;
	}

	public void setLibLDocument(String libLAbonnement) {
		this.libLDocument = libLAbonnement;
	}

	@Column(name = "qte_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "qte_l_document",table = "ta_l_abonnement", champEntite="qteLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getQteLDocument() {
		return this.qteLDocument;
	}

	public void setQteLDocument(BigDecimal qteLAbonnement) {		
		BigDecimal qteLDocumentOld = this.qteLDocument;
		this.qteLDocument = qteLAbonnement;
		if(legrain) {
			calculMontant();
			firePropertyChange(new PropertyChangeEvent(this,"qteLDocument",qteLDocumentOld,qteLAbonnement));
		}
	}

	@Column(name = "qte2_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "qte2_l_document",table = "ta_l_abonnement", champEntite="qte2LDocument", clazz = TaLAbonnement.class)
	public BigDecimal getQte2LDocument() {
		return this.qte2LDocument;
	}

	public void setQte2LDocument(BigDecimal qte2LAbonnement) {
		this.qte2LDocument = qte2LAbonnement;
	}

	@Column(name = "u1_l_document", length = 20)
	@LgrHibernateValidated(champBd = "u1_l_document",table = "ta_l_abonnement", champEntite="u1LDocument", clazz = TaLAbonnement.class)
	public String getU1LDocument() {
		return this.u1LDocument;
	}

	public void setU1LDocument(String u1LAbonnement) {
		this.u1LDocument = u1LAbonnement;
	}

	@Column(name = "u2_l_document", length = 20)
	@LgrHibernateValidated(champBd = "u2_l_document",table = "ta_l_abonnement", champEntite="u2LDocument", clazz = TaLAbonnement.class)
	public String getU2LDocument() {
		return this.u2LDocument;
	}

	public void setU2LDocument(String u2LAbonnement) {
		this.u2LDocument = u2LAbonnement;
	}

	@Column(name = "prix_u_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "prix_u_l_document",table = "ta_l_abonnement", champEntite="prixULDocument", clazz = TaLAbonnement.class)
	public BigDecimal getPrixULDocument() {
		return this.prixULDocument;
	}

	public void setPrixULDocument(BigDecimal prixULAbonnement) {
		this.prixULDocument = prixULAbonnement;
		if(legrain) {
			calculMontant();
		}
	}

	@Column(name = "taux_tva_l_document", precision = 15, scale = 4)
	@LgrHibernateValidated(champBd = "taux_tva_l_document",table = "ta_l_abonnement", champEntite="tauxTvaLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getTauxTvaLDocument() {
		return this.tauxTvaLDocument;
	}

	public void setTauxTvaLDocument(BigDecimal tauxTvaLAbonnement) {
		this.tauxTvaLDocument = tauxTvaLAbonnement;
	}

	@Column(name = "compte_l_document", length = 8)
	@LgrHibernateValidated(champBd = "compte_l_document",table = "ta_l_abonnement", champEntite="compteLDocument", clazz = TaLAbonnement.class)
	public String getCompteLDocument() {
		return this.compteLDocument;
	}

	public void setCompteLDocument(String compteLAbonnement) {
		this.compteLDocument = compteLAbonnement;
	}

	@Column(name = "code_tva_l_document", length = 20)
	@LgrHibernateValidated(champBd = "code_tva_l_document",table = "ta_l_abonnement", champEntite="codeTvaLDocument", clazz = TaLAbonnement.class)
	public String getCodeTvaLDocument() {
		return this.codeTvaLDocument;
	}

	public void setCodeTvaLDocument(String codeTvaLAbonnement) {
		this.codeTvaLDocument = codeTvaLAbonnement;
	}
	
	@Column(name = "lib_tva_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "lib_tva_l_document",table = "ta_l_abonnement", champEntite="libTvaLDocument", clazz = TaLAbonnement.class)
	public String getLibTvaLDocument() {
		return this.libTvaLDocument;
	}
	public void setLibTvaLDocument(String libTvaLDocument) {
		this.libTvaLDocument = libTvaLDocument;
	}

	@Column(name = "code_t_tva_l_document", length = 1)
	@LgrHibernateValidated(champBd = "code_t_tva_l_document",table = "ta_l_abonnement", champEntite="codeTTvaLDocument", clazz = TaLAbonnement.class)
	public String getCodeTTvaLDocument() {
		return this.codeTTvaLDocument;
	}

	public void setCodeTTvaLDocument(String codeTTvaLAbonnement) {
		this.codeTTvaLDocument = codeTTvaLAbonnement;
	}

	@Column(name = "mt_ht_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "mt_ht_l_document",table = "ta_l_abonnement", champEntite="mtHtLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getMtHtLDocument() {
		return this.mtHtLDocument;
	}

	public void setMtHtLDocument(BigDecimal mtHtLAbonnement) {
		this.mtHtLDocument = LibCalcul.arrondi(mtHtLAbonnement);
	}

	@Column(name = "mt_ttc_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "mt_ttc_l_document",table = "ta_l_abonnement", champEntite="mtTtcLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getMtTtcLDocument() {
		return this.mtTtcLDocument;
	}

	public void setMtTtcLDocument(BigDecimal mtTtcLAbonnement) {
		this.mtTtcLDocument = LibCalcul.arrondi(mtTtcLAbonnement);
	}

	@Column(name = "rem_tx_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "rem_tx_l_document",table = "ta_l_abonnement", champEntite="remTxLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getRemTxLDocument() {
		return this.remTxLDocument;
	}

	public void setRemTxLDocument(BigDecimal remTxLAbonnement) {
		this.remTxLDocument = remTxLAbonnement;
		if(legrain) {
			//calculMontant();
			
			System.out.println("===****=== Transfert de code metier des entites vers les services, à bien vérifier");
			//passage ejb => dans TaAbonnementService
			taDocument.calculeTvaEtTotaux();
		}
		
	}

	@Column(name = "rem_ht_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "rem_ht_l_document",table = "ta_l_abonnement", champEntite="remHtLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getRemHtLDocument() {
		return this.remHtLDocument;
	}
	
	public void setRemHtLDocument(BigDecimal remHtLAbonnement) {
		this.remHtLDocument = remHtLAbonnement;
	}

	@Column(name = "qui_cree", length = 50)
	public String getQuiCree() {
		return this.quiCree;
	}

	public void setQuiCree(String quiCreeLAbonnement) {
		this.quiCree = quiCreeLAbonnement;
	}

	@Temporal(TemporalType.TIMESTAMP)
	@Column(name = "quand_cree", length = 19)
	public Date getQuandCree() {
		return this.quandCree;
	}

	public void setQuandCree(Date quandCreeLAbonnement) {
		this.quandCree = quandCreeLAbonnement;
	}

	@Column(name = "qui_modif", length = 50)
	public String getQuiModif() {
		return this.quiModif;
	}

	public void setQuiModif(String quiModifLAbonnement) {
		this.quiModif = quiModifLAbonnement;
	}

	@Temporal(TemporalType.TIMESTAMP)
	@Column(name = "quand_modif", length = 19)
	public Date getQuandModif() {
		return this.quandModif;
	}

	public void setQuandModif(Date quandModifLAbonnement) {
		this.quandModif = quandModifLAbonnement;
	}

	@Column(name = "ip_acces", length = 50)
	public String getIpAcces() {
		return this.ipAcces;
	}

	public void setIpAcces(String ipAcces) {
		this.ipAcces = ipAcces;
	}

//	@Version
//	@Column(name = "version_obj")
//	public Integer getVersionObj() {
//		return this.versionObj;
//	}
//
//	public void setVersionObj(Integer versionObj) {
//		this.versionObj = versionObj;
//	}

//	@Override
//	public boolean ligneEstVide() {
//		if (taArticle!=null)return false;
//		if (libLDocument!=null && !libLDocument.equals(""))return false;		
//		return true;
//	}
	
	public void initialiseLigne(boolean reset){
		if (reset){
			setLibLDocument("");
			setQteLDocument(null);
			setQte2LDocument(null);
			setU1LDocument("") ;
			setU2LDocument("") ;
			setPrixULDocument(null);
			setTauxTvaLDocument(null);
			setCodeTvaLDocument("");
			setCodeTTvaLDocument("");
			setMtHtLDocument(null);
			setMtTtcLDocument(null);
			setRemTxLDocument(null);
			setRemHtLDocument(null);
		}else {
			setLibLDocument("");
			setQteLDocument(new BigDecimal(0));
			setQte2LDocument(new BigDecimal(0));
			setU1LDocument("");
			setU2LDocument("");
			setPrixULDocument(new BigDecimal(0)) ;
			setTauxTvaLDocument(new BigDecimal(0));
			setCodeTvaLDocument("");
			setCodeTTvaLDocument("");
			setMtHtLDocument(new BigDecimal(0));
			setMtTtcLDocument(new BigDecimal(0));
			setRemTxLDocument(new BigDecimal(0));
			setRemHtLDocument(new BigDecimal(0)) ;
		}
		setTaArticle(null);	
	}

	public void calculMontant() {
		if(qteLDocument!=null && prixULDocument!=null) {
			if(taDocument!=null) {//#JPA
				setTxRemHtDocument(taDocument.getTxRemHtDocument());
				if(taDocument.getTtc()==1) {
					setMtTtcLDocument(qteLDocument.multiply(prixULDocument));
					if(getCoefMultiplicateur() != null) {
						setMtTtcLDocument(getMtTtcLDocument().multiply(getCoefMultiplicateur()));
					}
					
					if(remTxLDocument!=null && remTxLDocument.signum()!=0){
						setMtTtcLDocument(getMtTtcLDocument().subtract(getMtTtcLDocument().multiply(remTxLDocument.divide(new BigDecimal(100)))));
					}
					if( tauxTvaLDocument!=null && tauxTvaLDocument.signum()!=0){
						setMtHtLDocument(mtTtcLDocument.divide(BigDecimal.valueOf(1).add((tauxTvaLDocument.divide(new BigDecimal(100),MathContext.DECIMAL128).setScale(3,BigDecimal.ROUND_HALF_UP)
								)),MathContext.DECIMAL128).setScale(2,BigDecimal.ROUND_HALF_UP));
					} else {
						setMtHtLDocument(mtTtcLDocument);
					}
					
				} else {
					setMtHtLDocument(qteLDocument.multiply(prixULDocument));
					if(getCoefMultiplicateur() != null) {
						setMtHtLDocument(getMtHtLDocument().multiply(getCoefMultiplicateur()));
					}
					if(remTxLDocument!=null && remTxLDocument.signum()!=0){
						setMtHtLDocument(getMtHtLDocument().subtract(getMtHtLDocument().multiply(remTxLDocument.divide(new BigDecimal(100)))));
					}
					if( tauxTvaLDocument!=null && tauxTvaLDocument.signum()!=0){
						setMtTtcLDocument(mtHtLDocument.add((mtHtLDocument.multiply(tauxTvaLDocument.divide(new BigDecimal(100))))));
					} else {
						setMtTtcLDocument(mtHtLDocument);
					}
				
				}
				setMtTtcLApresRemiseGlobaleDocument(getMtTtcLDocument());
				setMtHtLApresRemiseGlobaleDocument(getMtHtLDocument());
			}
		}
	}
	
	@Transient
	public BigDecimal getTxRemHtDocument() {
		return txRemHtDocument;
	}

	public void setTxRemHtDocument(BigDecimal txRemHtAbonnement) {
		this.txRemHtDocument = txRemHtAbonnement;
	}
	public TaLAbonnement clone() {
		TaLAbonnement ligne = new TaLAbonnement();
		try {
//			ligne = (TaLAbonnement)super.clone();
			ligne.setIdLDocument(0);
			ligne.setVersion(version);
			ligne.setTaTLigne(taTLigne);
			ligne.setTaDocument(taDocument);
			ligne.setTaArticle(taArticle);
			ligne.setNumLigneLDocument(numLigneLDocument);
			ligne.setLibLDocument(libLDocument);
			ligne.setQteLDocument(qteLDocument);
			ligne.setQte2LDocument(qte2LDocument);
			ligne.setU1LDocument(u1LDocument);
			ligne.setU2LDocument(u2LDocument);
			ligne.setPrixULDocument(prixULDocument);
			ligne.setTauxTvaLDocument(tauxTvaLDocument);
			ligne.setCompteLDocument(compteLDocument);
			ligne.setCodeTvaLDocument(codeTvaLDocument);
			ligne.setCodeTTvaLDocument(codeTTvaLDocument);
			ligne.setMtHtLDocument(mtHtLDocument);
			ligne.setMtTtcLDocument(mtTtcLDocument);
			ligne.setRemTxLDocument(remTxLDocument);
			ligne.setRemHtLDocument(remHtLDocument);
			ligne.setQuiCree(quiCree);
			ligne.setQuandCree(quandCree);
			ligne.setQuiModif(quiModif);
			ligne.setQuandModif(quandModif);
			ligne.setIpAcces(ipAcces);
			ligne.setVersionObj(versionObj);			
		} catch(Exception cnse) {
			logger.error("",cnse);
		}
		// on renvoie le clone
		return ligne;
	}

	//@Transient
	@Column(name = "mt_ht_apr_rem_globale", precision = 15)
	@LgrHibernateValidated(champBd = "mt_apr_rem_globale",table = "ta_l_abonnement", champEntite="mtHtLApresRemiseGlobaleDocument", clazz = TaLAbonnement.class)
	public BigDecimal getMtHtLApresRemiseGlobaleDocument() {
		return mtHtLApresRemiseGlobaleDocument;
	}

	public void setMtHtLApresRemiseGlobaleDocument(
			BigDecimal mtHtLApresRemiseGlobaleDocument) {
		this.mtHtLApresRemiseGlobaleDocument = mtHtLApresRemiseGlobaleDocument;
	}

	//@Transient
	@Column(name = "mt_ttc_apr_rem_globale", precision = 15)
	@LgrHibernateValidated(champBd = "mt_ttc_apr_rem_globale",table = "ta_l_abonnement", champEntite="mtTtcLApresRemiseGlobaleDocument", clazz = TaLAbonnement.class)
	public BigDecimal getMtTtcLApresRemiseGlobaleDocument() {
		return mtTtcLApresRemiseGlobaleDocument;
	}

	public void setMtTtcLApresRemiseGlobaleDocument(
			BigDecimal mtTtcLApresRemiseGlobaleDocument) {
		this.mtTtcLApresRemiseGlobaleDocument = mtTtcLApresRemiseGlobaleDocument;
	}

	public void setLegrain(boolean legrain) {
		this.legrain = legrain;
	}

	@Transient
	public TaLot getTaLot() {
		// TODO Auto-generated method stub
		return null;
	}

	@Transient
	public void setTaLot(TaLot taLot) {
		// TODO Auto-generated method stub
		
	}

//	@javax.persistence.OneToOne(cascade = CascadeType.ALL, fetch = FetchType.EAGER, mappedBy = "taLAbonnement")
//	public TaStripeSubscriptionItem getTaStripeSubscriptionItem() {
//		return taStripeSubscriptionItem;
//	}
//
//	public void setTaStripeSubscriptionItem(TaStripeSubscriptionItem taStripeSubscriptionItem) {
//		this.taStripeSubscriptionItem = taStripeSubscriptionItem;
//	}

	@Transient
	public List<TaLigneALigneSupplementDTO> getListeSupplement() {
		// TODO Auto-generated method stub
		return null;
	}

	@Transient
	public void setListeSupplement(List<TaLigneALigneSupplementDTO> listeSupplement) {
		// TODO Auto-generated method stub
		
	}

	@Transient
	public List<TaLigneALigneSupplementDTO> getListeLigneAIntegrer() {
		// TODO Auto-generated method stub
		return null;
	}

	@Transient
	public void setListeLigneAIntegrer(List<TaLigneALigneSupplementDTO> listeLigneAIntegrer) {
		// TODO Auto-generated method stub
		
	}



	@Transient
	public void addREtatLigneDoc(TaEtat taEtat) {
		TaREtatLigneDocument rEtat=getTaREtatLigneDocument();
		if(rEtat!=null) {
			TaHistREtatLigneDocument hist=new TaHistREtatLigneDocument();
			hist.setTaEtat(getTaREtatLigneDocument().getTaEtat());
			hist.setTaLAbonnement(this);
			this.getTaHistREtatLigneDocuments().add(hist);
		}else rEtat=new TaREtatLigneDocument();
		
		rEtat.setTaEtat(taEtat);
		rEtat.setTaLAbonnement(this);
		this.setTaREtatLigneDocument(rEtat);
		this.getTaREtatLigneDocuments().add(rEtat);
	}

	
	@Column(name = "id_externe")
	public String getIdExterne() {
		return idExterne;
	}

	public void setIdExterne(String idExterne) {
		this.idExterne = idExterne;
	}
	@ManyToOne(fetch = FetchType.LAZY)
	@JoinColumn(name = "id_stripe_plan")
	public TaStripePlan getTaPlan() {
		return taPlan;
	}

	public void setTaPlan(TaStripePlan taPlan) {
		this.taPlan = taPlan;
	}
	@Column(name = "complement_1")
	public String getComplement1() {
		return complement1;
	}

	public void setComplement1(String complement1) {
		this.complement1 = complement1;
	}
	@Column(name = "complement_2")
	public String getComplement2() {
		return complement2;
	}

	public void setComplement2(String complement2) {
		this.complement2 = complement2;
	}
	@Column(name = "complement_3")
	public String getComplement3() {
		return complement3;
	}

	public void setComplement3(String complement3) {
		this.complement3 = complement3;
	}

	@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = "taLAbonnement", orphanRemoval=true)
	@Fetch(FetchMode.SUBSELECT)
	@XmlTransient
	public Set<TaLigneALigne> getTaLigneALignes() {
		return this.taLigneALignes;
	}

	public void setTaLigneALignes(Set<TaLigneALigne> taLigneALignes) {
		this.taLigneALignes = taLigneALignes;
	}
	
	

	
	@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = "taLAbonnement", orphanRemoval = true)
	public Set<TaREtatLigneDocument> getTaREtatLigneDocuments() {
		return this.taREtatLigneDocuments;
	}

	public void setTaREtatLigneDocuments(Set<TaREtatLigneDocument> taREtats) {
		this.taREtatLigneDocuments = taREtats;
	}
	

	
	@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = "taLAbonnement", orphanRemoval = true)
	public Set<TaHistREtatLigneDocument> getTaHistREtatLigneDocuments() {
		return this.taHistREtatLigneDocuments;
	}

	public void setTaHistREtatLigneDocuments(Set<TaHistREtatLigneDocument> taHistREtatLigneDocuments) {
		this.taHistREtatLigneDocuments = taHistREtatLigneDocuments;
	}
	@Temporal(TemporalType.DATE)
	@Column(name = "date_debut_abonnement" )
	public Date getDateDebutAbonnement() {
		return dateDebutAbonnement;
	}

	public void setDateDebutAbonnement(Date dateDebutAbonnement) {
		this.dateDebutAbonnement = dateDebutAbonnement;
	}
	@Column(name = "coef_multiplicateur", precision = 15 )
	public BigDecimal getCoefMultiplicateur() {
		return coefMultiplicateur;
	}

	public void setCoefMultiplicateur(BigDecimal coefMultiplicateur) {
		this.coefMultiplicateur = coefMultiplicateur;
	}
	@Column(name = "nom_dossier")
	public String getNomDossier() {
		return nomDossier;
	}

	public void setNomDossier(String nomDossier) {
		this.nomDossier = nomDossier;
	}
//	@ManyToOne(fetch = FetchType.EAGER)
//	@JoinColumn(name = "id_r_etat")
//	public TaREtatLigneDocument getTaREtat() {
//		return taREtat;
//	}
//
//	public void setTaREtat(TaREtatLigneDocument taREtat) {
//		this.taREtat = taREtat;
//	}
	@Column(name = "commission_bancaire", precision = 15)
	public BigDecimal getCommissionBancaire() {
		return commissionBancaire;
	}

	public void setCommissionBancaire(BigDecimal commissionBancaire) {
		this.commissionBancaire = commissionBancaire;
	}
	@Column(name = "commission_panier", precision = 15)
	public BigDecimal getCommissionPanier() {
		return commissionPanier;
	}

	public void setCommissionPanier(BigDecimal commissionPanier) {
		this.commissionPanier = commissionPanier;
	}

	@Transient
	public Set<TaLigneALigneEcheance> getTaLigneALignesEcheance() {
		// TODO Auto-generated method stub
		return null;
	}

	@Transient
	public void setTaLigneALignesEcheance(Set<TaLigneALigneEcheance> taLigneALignes) {
		// TODO Auto-generated method stub
		
	}

	@Transient
	public Boolean getAbonnement() {
		// TODO Auto-generated method stub
		return false;
	}

	@Transient
	public void setAbonnement(Boolean abonnement) {
		// TODO Auto-generated method stub
		
	}

	@Transient
	public void setTaEntrepot(TaEntrepot findById) {
		// TODO Auto-generated method stub
		
	}

	@Transient
	public void setEmplacementLDocument(String emplacement) {
		// TODO Auto-generated method stub
		
	}

	@Transient
	public TaEntrepot getTaEntrepot() {
		// TODO Auto-generated method stub
		return null;
	}

	@Transient
	public String getEmplacementLDocument() {
		// TODO Auto-generated method stub
		return null;
	}




	@Column(name = "u_saisie_l_document", length = 20)
	@LgrHibernateValidated(champBd = "u_saisie_l_document",table = "ta_l_abonnement", champEntite="uSaisieLDocument", clazz = TaLAbonnement.class)
	public String getUSaisieLDocument() {
		return uSaisieLDocument;
	}

	public void setUSaisieLDocument(String uSaisieLDocument) {
		this.uSaisieLDocument = uSaisieLDocument;
	}

	@Column(name = "qte_saisie_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "qte_saisie_l_document",table = "ta_l_abonnement", champEntite="qteSaisieLDocument", clazz = TaLAbonnement.class)
	public BigDecimal getQteSaisieLDocument() {
		return qteSaisieLDocument;
	}

	public void setQteSaisieLDocument(BigDecimal qteSaisieLDocument) {
		this.qteSaisieLDocument = qteSaisieLDocument;
	}

	@Column(name = "titre_transport_l_document", length = 20)
	@LgrHibernateValidated(champBd = "titre_transport_l_document",table = "ta_l_abonnement", champEntite="codeTitreTransport", clazz = TaLAbonnement.class)
	public String getCodeTitreTransport() {
		return this.codeTitreTransport;
	}

	public void setCodeTitreTransport(String titreTransport) {
		this.codeTitreTransport = titreTransport;
	}
	
	@Column(name = "qte_titre_transport_l_document", precision = 15)
	@LgrHibernateValidated(champBd = "qte_titre_transport_l_document",table = "ta_l_abonnement", champEntite="qteTitreTransport", clazz = TaLAbonnement.class)
	public BigDecimal getQteTitreTransport() {
		return this.qteTitreTransport;
	}

	public void setQteTitreTransport(BigDecimal qteTitreTransport) {
		this.qteTitreTransport = qteTitreTransport;
	}

}
